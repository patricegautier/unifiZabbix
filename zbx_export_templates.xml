<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.2</version>
    <date>2020-12-31T03:36:00Z</date>
    <groups>
        <group>
            <name>Patrice</name>
        </group>
        <group>
            <name>Unifi</name>
        </group>
        <group>
            <name>unifiZabbix</name>
        </group>
        <group>
            <name>Unifi Zabbix Export</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>SunMAX SolarPoint</template>
            <name>SunMAX SolarPoint</name>
            <groups>
                <group>
                    <name>Unifi Zabbix Export</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Battery</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>Battery Charge</name>
                    <type>DEPENDENT</type>
                    <key>batteryCharge</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Battery</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.result[1].results.batteries[0].charge</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                    </master_item>
                </item>
                <item>
                    <name>Battery Voltage</name>
                    <type>DEPENDENT</type>
                    <key>batteryVoltage</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>V</units>
                    <applications>
                        <application>
                            <name>Battery</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.result[1].results.batteries[0].voltage</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                    </master_item>
                </item>
                <item>
                    <name>Net Power Consumption</name>
                    <type>CALCULATED</type>
                    <key>net_power_consumption</key>
                    <value_type>FLOAT</value_type>
                    <units>W</units>
                    <params>last(pvInputPower) - last(powerOutput)</params>
                    <applications>
                        <application>
                            <name>Battery</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Power Output</name>
                    <type>DEPENDENT</type>
                    <key>powerOutput</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>W</units>
                    <applications>
                        <application>
                            <name>Battery</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.result[1].results.output.power</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                    </master_item>
                </item>
                <item>
                    <name>Power Input from Solar Array</name>
                    <type>DEPENDENT</type>
                    <key>pvInputPower</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>W</units>
                    <applications>
                        <application>
                            <name>Battery</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.result[1].results.pv.power</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                    </master_item>
                </item>
                <item>
                    <name>Voltage from Solar Array</name>
                    <type>DEPENDENT</type>
                    <key>pvInputVoltage</key>
                    <delay>0</delay>
                    <units>V</units>
                    <applications>
                        <application>
                            <name>Battery</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.result[1].results.pv.voltage</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                    </master_item>
                </item>
                <item>
                    <name>batteryJson</name>
                    <type>EXTERNAL</type>
                    <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Battery</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Output Voltage</name>
                    <type>DEPENDENT</type>
                    <key>voltageOutput</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>V</units>
                    <applications>
                        <application>
                            <name>Battery</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.result[1].results.output.voltage</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                    </master_item>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>Power Port Discovery</name>
                    <type>DEPENDENT</type>
                    <key>power_port_discovery</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#PORT_NAME} Port Enabled</name>
                            <type>DEPENDENT</type>
                            <key>port__enabled_[{#PORT_NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <applications>
                                <application>
                                    <name>Battery</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.result[1].results.output.pins[ ?(@.name=='{#PORT_NAME}') ].enabled.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>{#PORT_NAME} Port Low Voltage</name>
                            <type>DEPENDENT</type>
                            <key>port__low_voltage_[{#PORT_NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <applications>
                                <application>
                                    <name>Battery</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.result[1].results.output.pins[ ?(@.name=='{#PORT_NAME}') ].low_voltage.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last(#1)}=&quot;true&quot;</expression>
                                    <name>{#PORT_NAME} Port is Low Voltage</name>
                                    <priority>INFO</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{#PORT_NAME} Port On</name>
                            <type>DEPENDENT</type>
                            <key>port__on_[{#PORT_NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <applications>
                                <application>
                                    <name>Battery</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.result[1].results.output.pins[ ?(@.name=='{#PORT_NAME}') ].on.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>{#PORT_NAME} Port Suspended</name>
                            <type>DEPENDENT</type>
                            <key>port__suspended_[{#PORT_NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <applications>
                                <application>
                                    <name>Battery</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.result[1].results.output.pins[ ?(@.name=='{#PORT_NAME}') ].suspended.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last(#1)}=&quot;true&quot;</expression>
                                    <name>{#PORT_NAME} Port is Suspended</name>
                                    <priority>WARNING</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>solarpointBattery.sh[&quot;-u&quot;, &quot;{$SOLARPOINT_USERNAME}&quot;, &quot;-p&quot;, &quot;{$SOLARPOINT_PASSWORD}&quot;, {HOST.CONN}]</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PORT_NAME}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.result[1].results.output.pins</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
        </template>
        <template>
            <template>UBNT Airmax</template>
            <name>UBNT Airmax</name>
            <groups>
                <group>
                    <name>Patrice</name>
                </group>
                <group>
                    <name>unifiZabbix</name>
                </group>
                <group>
                    <name>Unifi Zabbix Export</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Host</name>
                </application>
                <application>
                    <name>Radio</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>airTime</name>
                    <type>DEPENDENT</type>
                    <key>airTime</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>airTime=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{nodata({$UNIFI_ALERT_PERIOD})}=1</expression>
                            <name>{HOST.NAME} Device did not report statistics</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>AirTime Smooth</name>
                    <type>CALCULATED</type>
                    <key>airTimeSmooth</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(airTime,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>CPU</name>
                    <type>DEPENDENT</type>
                    <key>cpuUsage</key>
                    <delay>0</delay>
                    <status>DISABLED</status>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>cpuUsage=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                </item>
                <item>
                    <name>loadavg</name>
                    <type>DEPENDENT</type>
                    <key>loadavg</key>
                    <delay>0</delay>
                    <status>DISABLED</status>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>loadavg=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                </item>
                <item>
                    <name>noise</name>
                    <type>DEPENDENT</type>
                    <key>noise</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>db</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>noise=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                </item>
                <item>
                    <name>Noise Smooth</name>
                    <type>CALCULATED</type>
                    <key>noiseSmooth</key>
                    <value_type>FLOAT</value_type>
                    <units>dB</units>
                    <params>avg(noise,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>signal</name>
                    <type>DEPENDENT</type>
                    <key>signal</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>db</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>signal=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                </item>
                <item>
                    <name>Signal Smooth</name>
                    <type>CALCULATED</type>
                    <key>signalSmooth</key>
                    <value_type>FLOAT</value_type>
                    <units>dB</units>
                    <params>avg(signal,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>mca-status</name>
                    <type>SSH</type>
                    <key>ssh.run[mca-status]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>/bin/mca-status</params>
                    <authtype>PUBLIC_KEY</authtype>
                    <username>{$UNIFI_USER}</username>
                    <publickey>{$UNIFI_PUB_KEY}</publickey>
                    <privatekey>{$UNIFI_PRIV_KEY}</privatekey>
                </item>
                <item>
                    <name>wlanDownlinkCapacity</name>
                    <type>DEPENDENT</type>
                    <key>wlanDownlinkCapacity</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>wlanDownlinkCapacity=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>1000</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                </item>
                <item>
                    <name>WAN Downlink Capacity Smooth</name>
                    <type>CALCULATED</type>
                    <key>wlanDownlinkCapacitySmooth</key>
                    <value_type>FLOAT</value_type>
                    <units>bps</units>
                    <params>avg(wlanDownlinkCapacity,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>wlanRxBandwidth</name>
                    <type>DEPENDENT</type>
                    <key>wlanRxBandwidth</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>wlanRxBytes=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                </item>
                <item>
                    <name>WAN Reception Bandwidth Smooth</name>
                    <type>CALCULATED</type>
                    <key>wlanRxBandwidthSmooth</key>
                    <value_type>FLOAT</value_type>
                    <units>bps</units>
                    <params>avg(wlanRxBandwidth,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>wlanRxErrors</name>
                    <type>DEPENDENT</type>
                    <key>wlanRxErrors</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>wlanRxErrors=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                </item>
                <item>
                    <name>wlanTxBandwidth</name>
                    <type>DEPENDENT</type>
                    <key>wlanTxBandwidth</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>wlanTxBytes=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                </item>
                <item>
                    <name>WAN Transmission Bandwidth Smooth</name>
                    <type>CALCULATED</type>
                    <key>wlanTxBandwidthSmooth</key>
                    <value_type>FLOAT</value_type>
                    <units>bps</units>
                    <params>avg(wlanTxBandwidth,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>wlanTxErrors</name>
                    <type>DEPENDENT</type>
                    <key>wlanTxErrors</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>wlanTxErrors=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                </item>
                <item>
                    <name>wlanUplinkCapacity</name>
                    <type>DEPENDENT</type>
                    <key>wlanUplinkCapacity</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>wlanUplinkCapacity=(.*)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>1000</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mca-status]</key>
                    </master_item>
                </item>
                <item>
                    <name>WAN Uplink Capacity Smooth</name>
                    <type>CALCULATED</type>
                    <key>wlanUplinkCapacitySmooth</key>
                    <value_type>FLOAT</value_type>
                    <units>bps</units>
                    <params>avg(wlanUplinkCapacity,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
            </items>
        </template>
        <template>
            <template>Unifi AP</template>
            <name>Unifi AP</name>
            <description>uses mca-dump via ssh to get AP info.

Assign this template to all APs in your site</description>
            <groups>
                <group>
                    <name>Patrice</name>
                </group>
                <group>
                    <name>Unifi</name>
                </group>
                <group>
                    <name>unifiZabbix</name>
                </group>
                <group>
                    <name>Unifi Zabbix Export</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Host</name>
                </application>
                <application>
                    <name>Radio</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>2G Channel Interference</name>
                    <type>CALCULATED</type>
                    <key>2g_interference</key>
                    <units>%</units>
                    <params>(last(2g_interference_raw)&gt;0)*last(2g_interference_raw)</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>2G Channel Interference raw</name>
                    <type>CALCULATED</type>
                    <key>2g_interference_raw</key>
                    <units>%</units>
                    <params>((last(cu_total_2g)- last(cu_self_tx_2g) - last(cu_self_rx_2g))&gt;0)*(last(cu_total_2g)- last(cu_self_tx_2g) - last(cu_self_rx_2g))</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{avg({$UNIFI_ALERT_PERIOD})}&gt;40</expression>
                            <name>{HOST.NAME} 2G Interference &gt; 40%</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>2G Channel Interference Smooth</name>
                    <type>CALCULATED</type>
                    <key>2g_interference_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(2g_interference,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>5G Channel Interference</name>
                    <type>CALCULATED</type>
                    <key>5g_interference</key>
                    <units>%</units>
                    <params>(last(5g_interference_raw)&gt;0)*last(5g_interference_raw)</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>5G Channel Interference Raw</name>
                    <type>CALCULATED</type>
                    <key>5g_interference_raw</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>last(cu_total_5g) - last(cu_self_rx_5g) - last(cu_self_tx_5g)</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{avg({$UNIFI_ALERT_PERIOD})}&gt;20</expression>
                            <name>{HOST.NAME} 5G Interference &gt; 20%</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>5G Channel Interference Smooth</name>
                    <type>CALCULATED</type>
                    <key>5g_interference_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(5g_interference,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>CPU Utilization</name>
                    <type>DEPENDENT</type>
                    <key>cpu</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.['system-stats'].cpu</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>CPU Smooth</name>
                    <type>CALCULATED</type>
                    <key>cpu_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(cpu,{$UNIFI_SMOOTHING_COUNT})</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>2G Channel Utilization Smooth</name>
                    <type>CALCULATED</type>
                    <key>cu_avg_5mn_2g</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(cu_total_2g,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>5G Channel Utilization Smooth</name>
                    <type>CALCULATED</type>
                    <key>cu_avg_5mn_5g</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(cu_total_5g,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>2G Channel Usage Reception</name>
                    <type>DEPENDENT</type>
                    <key>cu_self_rx_2g</key>
                    <delay>0</delay>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.radio_table.[?(@.is_11ac != 'true')].athstats.cu_self_rx.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>5G Channel Usage Reception</name>
                    <type>DEPENDENT</type>
                    <key>cu_self_rx_5g</key>
                    <delay>0</delay>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.radio_table.[?(@.is_11ac == 'true')].athstats.cu_self_rx.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>2G Channel Usage Transmission</name>
                    <type>DEPENDENT</type>
                    <key>cu_self_tx_2g</key>
                    <delay>0</delay>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.radio_table.[?(@.is_11ac != 'true')].athstats.cu_self_tx.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>5G Channel Usage Transmission</name>
                    <type>DEPENDENT</type>
                    <key>cu_self_tx_5g</key>
                    <delay>0</delay>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.radio_table.[?(@.is_11ac == 'true')].athstats.cu_self_tx.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>2G Channel Usage Total</name>
                    <type>DEPENDENT</type>
                    <key>cu_total_2g</key>
                    <delay>0</delay>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.radio_table.[?(@.is_11ac != 'true')].athstats.cu_total.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{avg({$UNIFI_ALERT_PERIOD})}&gt;50</expression>
                            <name>{HOST.NAME} 2G Channel Usage &gt; 50%</name>
                            <priority>INFO</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{avg({$UNIFI_ALERT_PERIOD})}&gt;80</expression>
                            <name>{HOST.NAME} 2G Channel Usage &gt; 80%</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>5G Channel Usage Total</name>
                    <type>DEPENDENT</type>
                    <key>cu_total_5g</key>
                    <delay>0</delay>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.radio_table.[?(@.is_11ac == 'true')].athstats.cu_total.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{avg({$UNIFI_ALERT_PERIOD})}&gt;50</expression>
                            <name>{HOST.NAME} 5G Channel Usage &gt; 50%</name>
                            <priority>INFO</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{avg({$UNIFI_ALERT_PERIOD})}&gt;80</expression>
                            <name>{HOST.NAME} 5G Channel Usage &gt; 80%</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Hostname</name>
                    <type>DEPENDENT</type>
                    <key>hostname</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>NAME</inventory_link>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.hostname</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 1mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_1</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_1</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 5mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_5</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_5</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 15mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_15</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_15</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average Smooth</name>
                    <type>CALCULATED</type>
                    <key>loadavg_smooth</key>
                    <value_type>FLOAT</value_type>
                    <params>avg(loadavg_1,{$UNIFI_SMOOTHING_COUNT})</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>mca-dump</name>
                    <type>EXTERNAL</type>
                    <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                </item>
                <item>
                    <name>Memory Utilization</name>
                    <type>CALCULATED</type>
                    <key>memory</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>100* last(&quot;mem_used&quot;) / last(&quot;mem_total&quot;)</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Total Memory</name>
                    <type>DEPENDENT</type>
                    <key>mem_total</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.mem_total</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Memory Used</name>
                    <type>DEPENDENT</type>
                    <key>mem_used</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.mem_used</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Model</name>
                    <type>DEPENDENT</type>
                    <key>model</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>MODEL</inventory_link>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.model_display</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>2G Channel Retries</name>
                    <type>DEPENDENT</type>
                    <key>n_tx_xretries_2g</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.radio_table.[?(@.is_11ac != 'true')].athstats.n_tx_xretries.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>SIMPLE_CHANGE</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>5G Channel Retries</name>
                    <type>DEPENDENT</type>
                    <key>n_tx_xretries_5g</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.radio_table.[?(@.is_11ac == 'true')].athstats.n_tx_xretries.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>SIMPLE_CHANGE</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Satisfaction</name>
                    <type>DEPENDENT</type>
                    <key>sat</key>
                    <delay>0</delay>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.satisfaction</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>-1</parameter>
                                <parameter>100</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{avg({$UNIFI_ALERT_PERIOD})}&lt;80</expression>
                            <name>{HOST.NAME} Satisfaction &lt; 80 %</name>
                            <priority>INFO</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Satisfaction Smooth</name>
                    <type>CALCULATED</type>
                    <key>sat_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(sat,{$UNIFI_SMOOTHING_PERIOD})</params>
                </item>
                <item>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>uptime</key>
                    <delay>0</delay>
                    <units>S</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.uptime</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{nodata({$UNIFI_ALERT_PERIOD})}=1</expression>
                            <name>{HOST.NAME} did not report statistics</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{nodata(6h)}=1</expression>
                            <name>{HOST.NAME} did not report statistics for 6h</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Wireless Reception Bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>wireless_reception_bandwidth</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.vap_table.[*].rx_bytes.sum()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Wireless Reception Bandwidth Smooth</name>
                    <type>CALCULATED</type>
                    <key>wireless_reception_bandwidth_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>bps</units>
                    <params>avg(wireless_reception_bandwidth,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Wireless Transmission Bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>wireless_transmission_bandwidth</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.vap_table.[*].tx_bytes.sum()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Wireless Transmission Bandwidth Smooth</name>
                    <type>CALCULATED</type>
                    <key>wireless_transmission_bandwidth_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>bps</units>
                    <params>avg(wireless_transmission_bandwidth,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>Wifi Network Discovery</name>
                    <type>DEPENDENT</type>
                    <key>wifi_network_discovery</key>
                    <delay>0</delay>
                    <description>Wifi Network Discovery Rule</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#ESSID} Rx Bandwidth</name>
                            <type>DEPENDENT</type>
                            <key>rx_bandwidth[{#ESSID}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <applications>
                                <application>
                                    <name>Radio</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.vap_table.[ ?(@.essid == '{#ESSID}' ) ].rx_bytes.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>8</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>{#ESSID} Reception Bandwidth Smooth</name>
                            <type>CALCULATED</type>
                            <key>rx_bandwidth_smooth[{#ESSID}]</key>
                            <value_type>FLOAT</value_type>
                            <units>bps</units>
                            <params>avg(rx_bandwidth[{#ESSID}], {$UNIFI_SMOOTHING_PERIOD})</params>
                            <applications>
                                <application>
                                    <name>Radio</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <name>{#ESSID} Tx Bandwidth</name>
                            <type>DEPENDENT</type>
                            <key>tx_bandwidth[{#ESSID}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <applications>
                                <application>
                                    <name>Radio</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.vap_table.[ ?(@.essid == &quot;{#ESSID}&quot;) ].tx_bytes.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>8</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>{#ESSID} Transmission Bandwidth Smooth</name>
                            <type>CALCULATED</type>
                            <key>tx_bandwidth_smooth[{#ESSID}]</key>
                            <value_type>FLOAT</value_type>
                            <units>bps</units>
                            <params>avg(tx_bandwidth[{#ESSID}], {$UNIFI_SMOOTHING_PERIOD})</params>
                            <applications>
                                <application>
                                    <name>Radio</name>
                                </application>
                            </applications>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#ESSID}</lld_macro>
                            <path>$.essid</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.vap_table</parameter>
                            </parameters>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
        </template>
        <template>
            <template>Unifi Protect Cloud Key</template>
            <name>Unifi Protect Cloud Key</name>
            <description>Assign this template to your Cloud Keys running Protect</description>
            <groups>
                <group>
                    <name>Patrice</name>
                </group>
                <group>
                    <name>unifiZabbix</name>
                </group>
                <group>
                    <name>Unifi Zabbix Export</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Network</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>Incoming Bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>IpExtInOctets</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Network</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.kernel.IpExtInOctets</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[nstat]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{nodata({$UNIFI_ALERT_PERIOD})}=1</expression>
                            <name>{HOST.NAME} didnt report statistics</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{avg(3600s)} &lt; {avg(3600s, 1d)}*.7</expression>
                            <name>{HOST.NAME} Incoming Bandwidth Too Low</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>nstat</name>
                    <type>SSH</type>
                    <key>ssh.run[nstat]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>nstat -j -a</params>
                    <authtype>PUBLIC_KEY</authtype>
                    <username>{$UNIFI_USER}</username>
                    <publickey>{$UNIFI_PUB_KEY}</publickey>
                    <privatekey>{$UNIFI_PRIV_KEY}</privatekey>
                    <applications>
                        <application>
                            <name>Network</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Web Entry Point</name>
                    <type>HTTP_AGENT</type>
                    <key>web_app</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <url>https://{HOST.NAME}:7443</url>
                    <retrieve_mode>HEADERS</retrieve_mode>
                </item>
            </items>
        </template>
        <template>
            <template>Unifi Protect NVR4</template>
            <name>Unifi Protect NVR4</name>
            <description>Assign this template to your UNVR4s running Protect</description>
            <groups>
                <group>
                    <name>Patrice</name>
                </group>
                <group>
                    <name>unifiZabbix</name>
                </group>
                <group>
                    <name>Unifi Zabbix Export</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Host</name>
                </application>
                <application>
                    <name>Network</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>CPU Idle</name>
                    <type>DEPENDENT</type>
                    <key>cpu_idle</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sysstat.hosts[0].statistics[0].cpuload[0].idle</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mpstat]</key>
                    </master_item>
                </item>
                <item>
                    <name>CPU smooth</name>
                    <type>CALCULATED</type>
                    <key>cpu_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(&quot;cpu_utilization&quot;, {$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>CPU Utlization</name>
                    <type>CALCULATED</type>
                    <key>cpu_utilization</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>100 - last(&quot;cpu_idle&quot;)</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Incoming Bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>IpExtInOctets</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Network</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.kernel.IpExtInOctets</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[nstat]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{nodata({$UNIFI_ALERT_PERIOD})}=1</expression>
                            <name>{HOST.NAME} didnt report statistics</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{avg(3600s)} &lt; {avg(3600s, 1d)}*.7</expression>
                            <name>{HOST.NAME} Incoming Bandwidth Too Low</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>nodename</name>
                    <type>DEPENDENT</type>
                    <key>nodename</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sysstat.hosts[0].nodename</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>ssh.run[mpstat]</key>
                    </master_item>
                </item>
                <item>
                    <name>mpstat</name>
                    <type>SSH</type>
                    <key>ssh.run[mpstat]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>mpstat -o JSON 1 1 | sed 's/&quot;cpu-load&quot;/&quot;cpuload&quot;/'</params>
                    <authtype>PUBLIC_KEY</authtype>
                    <username>root</username>
                    <publickey>{$UNIFI_PUB_KEY}</publickey>
                    <privatekey>{$UNIFI_PRIV_KEY}</privatekey>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>nstat</name>
                    <type>SSH</type>
                    <key>ssh.run[nstat]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>nstat -j -a</params>
                    <authtype>PUBLIC_KEY</authtype>
                    <username>root</username>
                    <publickey>{$UNIFI_PUB_KEY}</publickey>
                    <privatekey>{$UNIFI_PRIV_KEY}</privatekey>
                    <applications>
                        <application>
                            <name>Network</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Temp 1</name>
                    <type>SSH</type>
                    <key>ssh.run[temp1]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <value_type>FLOAT</value_type>
                    <units>C</units>
                    <params>cat /sys/bus/i2c/drivers/adt7475/4-002e/hwmon/hwmon0/device/temp1_input</params>
                    <authtype>PUBLIC_KEY</authtype>
                    <username>root</username>
                    <publickey>{$UNIFI_PUB_KEY}</publickey>
                    <privatekey>{$UNIFI_PRIV_KEY}</privatekey>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>Temp 2</name>
                    <type>SSH</type>
                    <key>ssh.run[temp2]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <value_type>FLOAT</value_type>
                    <units>C</units>
                    <params>cat /sys/bus/i2c/drivers/adt7475/4-002e/hwmon/hwmon0/device/temp2_input</params>
                    <authtype>PUBLIC_KEY</authtype>
                    <username>root</username>
                    <publickey>{$UNIFI_PUB_KEY}</publickey>
                    <privatekey>{$UNIFI_PRIV_KEY}</privatekey>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>Temp 3</name>
                    <type>SSH</type>
                    <key>ssh.run[temp3]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <value_type>FLOAT</value_type>
                    <units>C</units>
                    <params>cat /sys/bus/i2c/drivers/adt7475/4-002e/hwmon/hwmon0/device/temp3_input</params>
                    <authtype>PUBLIC_KEY</authtype>
                    <username>root</username>
                    <publickey>{$UNIFI_PUB_KEY}</publickey>
                    <privatekey>{$UNIFI_PRIV_KEY}</privatekey>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>Web Entry Point</name>
                    <type>HTTP_AGENT</type>
                    <key>web_app</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <url>https://{HOST.NAME}:7443</url>
                    <retrieve_mode>HEADERS</retrieve_mode>
                </item>
            </items>
        </template>
        <template>
            <template>Unifi Switch</template>
            <name>Unifi Switch</name>
            <description>Link this template to all Unifi switches</description>
            <groups>
                <group>
                    <name>Patrice</name>
                </group>
                <group>
                    <name>Unifi</name>
                </group>
                <group>
                    <name>unifiZabbix</name>
                </group>
                <group>
                    <name>Unifi Zabbix Export</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Host</name>
                </application>
                <application>
                    <name>Traffic</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>CPU Utilization</name>
                    <type>DEPENDENT</type>
                    <key>cpu</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.['system-stats'].cpu</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>CPU Smooth</name>
                    <type>CALCULATED</type>
                    <key>cpu_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(cpu,{$UNIFI_SMOOTHING_COUNT})</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Hostname</name>
                    <type>DEPENDENT</type>
                    <key>hostname</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>NAME</inventory_link>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.hostname</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 1mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_1</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_1</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 5mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_5</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_5</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 15mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_15</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_15</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average Smooth</name>
                    <type>CALCULATED</type>
                    <key>loadavg_smooth</key>
                    <value_type>FLOAT</value_type>
                    <params>avg(loadavg_1,{$UNIFI_SMOOTHING_COUNT})</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Max Total Power</name>
                    <type>DEPENDENT</type>
                    <key>max_total_power</key>
                    <delay>0</delay>
                    <units>W</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.total_max_power</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>mca-dump</name>
                    <type>EXTERNAL</type>
                    <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Memory Utilization</name>
                    <type>CALCULATED</type>
                    <key>memory</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>100* last(&quot;mem_used&quot;) / last(&quot;mem_total&quot;)</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Total Memory</name>
                    <type>DEPENDENT</type>
                    <key>mem_total</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.mem_total</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Memory Used</name>
                    <type>DEPENDENT</type>
                    <key>mem_used</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.mem_used</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Model</name>
                    <type>DEPENDENT</type>
                    <key>model</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>MODEL</inventory_link>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.model_display</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Overheating</name>
                    <type>DEPENDENT</type>
                    <key>overheating</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>CHAR</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.overheating</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>false</parameter>
                                <parameter>f</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>true</parameter>
                                <parameter>t</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{last()}&lt;&gt;&quot;f&quot;</expression>
                            <name>{HOST.NAME} is overheating</name>
                            <priority>HIGH</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Percentage Max Power</name>
                    <type>CALCULATED</type>
                    <key>percentage_max_power</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>100*last(&quot;power_consumed_smooth&quot;)/last(&quot;max_total_power&quot;)</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Power Consumed</name>
                    <type>DEPENDENT</type>
                    <key>power_consumed</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>W</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.port_table.[*].poe_power.sum()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Power Consumed Smooth</name>
                    <type>CALCULATED</type>
                    <key>power_consumed_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>W</units>
                    <params>avg(power_consumed,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Temperature</name>
                    <type>DEPENDENT</type>
                    <key>temperature</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>C</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.general_temperature</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{last()} &gt; {$UNIFI_ALERT_TEMP}</expression>
                            <name>{HOST.NAME} Temperature is &gt; {$UNIFI_ALERT_TEMP}C</name>
                            <priority>AVERAGE</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Total Rx Bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>total_rx_bandwidth</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Traffic</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.port_table[*].rx_bytes.sum()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Total Tx Bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>total_tx_bandwidth</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Traffic</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.port_table[*].tx_bytes.sum()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>uptime</key>
                    <delay>0</delay>
                    <units>S</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.uptime</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{nodata({$UNIFI_ALERT_PERIOD})}=1</expression>
                            <name>{HOST.NAME} did not report statistics</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{nodata(6h)}=1</expression>
                            <name>{HOST.NAME} did not report statistics for 6h</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>Switch Port Discovery</name>
                    <type>DEPENDENT</type>
                    <key>switch_port_discovery</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>Port {#PORT_IDX} Rx Bandwidth</name>
                            <type>DEPENDENT</type>
                            <key>rx_port_[{#PORT_IDX}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <applications>
                                <application>
                                    <name>Traffic</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.port_table[ ?(@.port_idx=='{#PORT_IDX}')].rx_bytes.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>8</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Port {#PORT_IDX} Tx Bandwidth</name>
                            <type>DEPENDENT</type>
                            <key>tx_port_[{#PORT_IDX}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <applications>
                                <application>
                                    <name>Traffic</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.port_table[ ?(@.port_idx=='{#PORT_IDX}')].tx_bytes.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>8</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{Unifi Switch:rx_port_[{#PORT_IDX}].last(#1)}&gt;100000000 or {Unifi Switch:tx_port_[{#PORT_IDX}].last(#1)}&gt;100000000</expression>
                            <name>Port {#PORT_IDX} above 100 Mbps</name>
                            <priority>INFO</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Unifi Switch:rx_port_[{#PORT_IDX}].last(#1)}&gt;500000000 or {Unifi Switch:tx_port_[{#PORT_IDX}].last(#1)}&gt;500000000</expression>
                            <name>Port {#PORT_IDX} above 500 Mbps</name>
                            <priority>WARNING</priority>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>Port I/O</name>
                            <graph_items>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Unifi Switch</host>
                                        <key>rx_port_[{#PORT_IDX}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Unifi Switch</host>
                                        <key>tx_port_[{#PORT_IDX}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;SWITCH&quot;]</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PORT_IDX}</lld_macro>
                            <path>$.port_idx</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.port_table</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
        </template>
        <template>
            <template>Unifi UDMP</template>
            <name>Unifi UDMP</name>
            <description>Link this template to UDMPs</description>
            <groups>
                <group>
                    <name>Patrice</name>
                </group>
                <group>
                    <name>unifiZabbix</name>
                </group>
                <group>
                    <name>Unifi Zabbix Export</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Host</name>
                </application>
                <application>
                    <name>Traffic</name>
                </application>
                <application>
                    <name>wan</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>CPU Utilization</name>
                    <type>DEPENDENT</type>
                    <key>cpu</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.['system-stats'].cpu</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>CPU Smooth</name>
                    <type>CALCULATED</type>
                    <key>cpu_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(cpu,{$UNIFI_SMOOTHING_COUNT})</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Download Bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>download_bandwidth</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].rx_bytes.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Download Bandwidth Smooth</name>
                    <type>CALCULATED</type>
                    <key>download_bandwidth_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>bps</units>
                    <params>avg(download_bandwidth,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Dropped Dowload Packets</name>
                    <type>DEPENDENT</type>
                    <key>dropped_dowload_packets</key>
                    <delay>0</delay>
                    <units>packet</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].rx_dropped.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>SIMPLE_CHANGE</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Dropped Upload Packets</name>
                    <type>DEPENDENT</type>
                    <key>dropped_upload_packets</key>
                    <delay>0</delay>
                    <units>packet</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].tx_dropped.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>SIMPLE_CHANGE</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Error Download Packets</name>
                    <type>DEPENDENT</type>
                    <key>error_download_packets</key>
                    <delay>0</delay>
                    <units>packet</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].rx_errors.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>SIMPLE_CHANGE</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Error Upload Packets</name>
                    <type>DEPENDENT</type>
                    <key>error_upload_packets</key>
                    <delay>0</delay>
                    <units>packet</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].tx_errors.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>SIMPLE_CHANGE</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Hostname</name>
                    <type>DEPENDENT</type>
                    <key>hostname</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>NAME</inventory_link>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.hostname</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 1mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_1</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_1</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 5mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_5</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_5</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 15mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_15</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_15</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average Smooth</name>
                    <type>CALCULATED</type>
                    <key>loadavg_smooth</key>
                    <value_type>FLOAT</value_type>
                    <params>avg(loadavg_1,{$UNIFI_SMOOTHING_COUNT})</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>mca-dump</name>
                    <type>EXTERNAL</type>
                    <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Memory Utilization</name>
                    <type>CALCULATED</type>
                    <key>memory</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>100* last(&quot;mem_used&quot;) / last(&quot;mem_total&quot;)</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Total Memory</name>
                    <type>DEPENDENT</type>
                    <key>mem_total</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.mem_total</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Memory Used</name>
                    <type>DEPENDENT</type>
                    <key>mem_used</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.mem_used</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Model</name>
                    <type>DEPENDENT</type>
                    <key>model</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>MODEL</inventory_link>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.model_display</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Temperature CPU</name>
                    <type>DEPENDENT</type>
                    <key>temperature.cpu</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>C</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.temperatures.[?(@.name == 'CPU')].value.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Temperature PHY</name>
                    <type>DEPENDENT</type>
                    <key>temperature.phy</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>C</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.temperatures.[?(@.name == 'PHY')].value.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Upload Bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>upload_bandwidth</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].tx_bytes.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Upload Bandwidth Smooth</name>
                    <type>CALCULATED</type>
                    <key>upload_bandwidth_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>bps</units>
                    <params>avg(upload_bandwidth,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>uptime</key>
                    <delay>0</delay>
                    <units>S</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.uptime</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{nodata({$UNIFI_ALERT_PERIOD})}=1</expression>
                            <name>{HOST.NAME} did not report statistics</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{nodata(6h)}=1</expression>
                            <name>{HOST.NAME} did not report statistics for 6h</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>WAN Latency</name>
                    <type>DEPENDENT</type>
                    <key>wan_latency</key>
                    <delay>0</delay>
                    <units>ms</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].latency.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Wan Latency Smooth</name>
                    <type>CALCULATED</type>
                    <key>wan_latency_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>ms</units>
                    <params>avg( wan_latency, {$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>Network Discovery</name>
                    <type>DEPENDENT</type>
                    <key>network_discovery</key>
                    <delay>0</delay>
                    <description>Network Discovery</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#NETWORK_NAME} VLAN Reception Bandwidth</name>
                            <type>DEPENDENT</type>
                            <key>vlan_rx_bandwitdh[{#NETWORK_NAME}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <applications>
                                <application>
                                    <name>Traffic</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.network_table[ ?(@.address == '{#NETWORK_NAME}' ) ].stats.rx_bytes.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>8</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>{#NETWORK_NAME} VLAN Transmission Bandwidth</name>
                            <type>DEPENDENT</type>
                            <key>vlan_tx_bandwitdh[{#NETWORK_NAME}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <applications>
                                <application>
                                    <name>Traffic</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.network_table[ ?(@.address == '{#NETWORK_NAME}' ) ].stats.tx_bytes.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>8</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>{#NETWORK_NAME} VLAN External Bandwidth</name>
                            <graph_items>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Unifi UDMP</host>
                                        <key>vlan_rx_bandwitdh[{#NETWORK_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Unifi UDMP</host>
                                        <key>vlan_tx_bandwitdh[{#NETWORK_NAME}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;UDMP&quot;]</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#NETWORK_NAME}</lld_macro>
                            <path>$.address</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network_table[?(@.active_dhcp_lease_count&gt;0)]</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$UNIFI_USER}</macro>
                    <value>root</value>
                    <description>AP Zabbix SSH Username - UDMP only supports root</description>
                </macro>
            </macros>
        </template>
        <template>
            <template>Unifi USG</template>
            <name>Unifi USG</name>
            <description>Link this template to USGs</description>
            <groups>
                <group>
                    <name>Patrice</name>
                </group>
                <group>
                    <name>unifiZabbix</name>
                </group>
                <group>
                    <name>Unifi Zabbix Export</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Host</name>
                </application>
                <application>
                    <name>Traffic</name>
                </application>
                <application>
                    <name>wan</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>CPU Utilization</name>
                    <type>DEPENDENT</type>
                    <key>cpu</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.['system-stats'].cpu</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>CPU Smooth</name>
                    <type>CALCULATED</type>
                    <key>cpu_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>avg(cpu,{$UNIFI_SMOOTHING_COUNT})</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Download Bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>download_bandwidth</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].rx_bytes.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Download Bandwidth Smooth</name>
                    <type>CALCULATED</type>
                    <key>download_bandwidth_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>bps</units>
                    <params>avg(download_bandwidth,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Dropped Dowload Packets</name>
                    <type>DEPENDENT</type>
                    <key>dropped_dowload_packets</key>
                    <delay>0</delay>
                    <units>packet</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].rx_dropped.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>SIMPLE_CHANGE</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Dropped Upload Packets</name>
                    <type>DEPENDENT</type>
                    <key>dropped_upload_packets</key>
                    <delay>0</delay>
                    <units>packet</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].tx_dropped.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>SIMPLE_CHANGE</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Error Download Packets</name>
                    <type>DEPENDENT</type>
                    <key>error_download_packets</key>
                    <delay>0</delay>
                    <units>packet</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].rx_errors.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>SIMPLE_CHANGE</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Error Upload Packets</name>
                    <type>DEPENDENT</type>
                    <key>error_upload_packets</key>
                    <delay>0</delay>
                    <units>packet</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].tx_errors.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>SIMPLE_CHANGE</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Hostname</name>
                    <type>DEPENDENT</type>
                    <key>hostname</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>NAME</inventory_link>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.hostname</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 1mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_1</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_1</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 5mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_5</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_5</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average 15mn</name>
                    <type>DEPENDENT</type>
                    <key>loadavg_15</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.loadavg_15</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Load Average Smooth</name>
                    <type>CALCULATED</type>
                    <key>loadavg_smooth</key>
                    <value_type>FLOAT</value_type>
                    <params>avg(loadavg_1,{$UNIFI_SMOOTHING_COUNT})</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>mca-dump</name>
                    <type>EXTERNAL</type>
                    <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Memory Utilization</name>
                    <type>CALCULATED</type>
                    <key>memory</key>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <params>100* last(&quot;mem_used&quot;) / last(&quot;mem_total&quot;)</params>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Total Memory</name>
                    <type>DEPENDENT</type>
                    <key>mem_total</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.mem_total</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Memory Used</name>
                    <type>DEPENDENT</type>
                    <key>mem_used</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.sys_stats.mem_used</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Model</name>
                    <type>DEPENDENT</type>
                    <key>model</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>MODEL</inventory_link>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.model_display</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Temperature CPU</name>
                    <type>DEPENDENT</type>
                    <key>temperature.cpu</key>
                    <delay>0</delay>
                    <units>C</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$..temps.CPU.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter> C</parameter>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Temperature PHY</name>
                    <type>DEPENDENT</type>
                    <key>temperature.phy</key>
                    <delay>0</delay>
                    <units>C</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$..temps.PHY.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter> C</parameter>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Upload Bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>upload_bandwidth</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].tx_bytes.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Upload Bandwidth Smooth</name>
                    <type>CALCULATED</type>
                    <key>upload_bandwidth_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>bps</units>
                    <params>avg(upload_bandwidth,{$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>uptime</key>
                    <delay>0</delay>
                    <units>S</units>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.uptime</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{nodata({$UNIFI_ALERT_PERIOD})}=1</expression>
                            <name>{HOST.NAME} did not report statistics</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{nodata(6h)}=1</expression>
                            <name>{HOST.NAME} did not report statistics for 6h</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>WAN Latency</name>
                    <type>DEPENDENT</type>
                    <key>wan_latency</key>
                    <delay>0</delay>
                    <units>ms</units>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.if_table.[?(@.latency &gt; 0)].latency.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                </item>
                <item>
                    <name>Wan Latency Smooth</name>
                    <type>CALCULATED</type>
                    <key>wan_latency_smooth</key>
                    <value_type>FLOAT</value_type>
                    <units>ms</units>
                    <params>avg( wan_latency, {$UNIFI_SMOOTHING_PERIOD})</params>
                    <applications>
                        <application>
                            <name>wan</name>
                        </application>
                    </applications>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>Network Discovery</name>
                    <type>DEPENDENT</type>
                    <key>network_discovery</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#NETWORK_NAME} VLAN Reception Bandwidth</name>
                            <type>DEPENDENT</type>
                            <key>vlan_rx_bandwitdh[{#NETWORK_NAME}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <applications>
                                <application>
                                    <name>Traffic</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.network_table[ ?(@.name == '{#NETWORK_NAME}' ) ].stats.rx_bytes.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>8</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>{#NETWORK_NAME} VLAN Transmission Bandwidth</name>
                            <type>DEPENDENT</type>
                            <key>vlan_tx_bandwitdh[{#NETWORK_NAME}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <applications>
                                <application>
                                    <name>Traffic</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.network_table[ ?(@.name == '{#NETWORK_NAME}' ) ].stats.tx_bytes.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>8</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>{#NETWORK_NAME} VLAN External Bandwidth</name>
                            <graph_items>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Unifi USG</host>
                                        <key>vlan_rx_bandwitdh[{#NETWORK_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Unifi USG</host>
                                        <key>vlan_tx_bandwitdh[{#NETWORK_NAME}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;USG&quot;]</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#NETWORK_NAME}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network_table[?(@.up==&quot;true&quot;)]</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
        </template>
        <template>
            <template>Unifi WiFi Site</template>
            <name>Unifi WiFi Site</name>
            <description>This template is meant to collect WiFi data across all of a site's APs.  Assign to one of the APs and set the {$UNIFI_AP_GROUP} macro to the name of a group that contains all of the APs you want to aggregate against.</description>
            <groups>
                <group>
                    <name>Patrice</name>
                </group>
                <group>
                    <name>unifiZabbix</name>
                </group>
                <group>
                    <name>Unifi Zabbix Export</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Host</name>
                </application>
                <application>
                    <name>Radio</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>Total Reception Wireless Bandwidth</name>
                    <type>AGGREGATE</type>
                    <key>grpsum[&quot;{$AP_GROUP}&quot;, &quot;wireless_reception_bandwidth&quot;,avg, {$UNIFI_SMOOTHING_PERIOD}]</key>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Total Transmission Wireless Bandwidth</name>
                    <type>AGGREGATE</type>
                    <key>grpsum[&quot;{$AP_GROUP}&quot;, &quot;wireless_transmission_bandwidth&quot;,avg, {$UNIFI_SMOOTHING_PERIOD}]</key>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>Radio</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>mca-dump</name>
                    <type>EXTERNAL</type>
                    <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    <delay>{$UNIFI_CHECK_FREQUENCY}</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Host</name>
                        </application>
                    </applications>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>Discover WiFi Networks</name>
                    <type>DEPENDENT</type>
                    <key>wifi_network_discovery_rule</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#ESSID} Total Reception Bandwidth Smooth</name>
                            <type>AGGREGATE</type>
                            <key>grpsum[&quot;{$AP_GROUP}&quot;, &quot;rx_bandwidth_smooth[{#ESSID}]&quot;, avg, {$UNIFI_SMOOTHING_PERIOD}]</key>
                            <units>bps</units>
                        </item_prototype>
                        <item_prototype>
                            <name>{#ESSID} Total Transmission Bandwidth</name>
                            <type>AGGREGATE</type>
                            <key>grpsum[&quot;{$AP_GROUP}&quot;, &quot;tx_bandwidth_smooth[{#ESSID}]&quot;, avg, &quot;{$UNIFI_SMOOTHING_PERIOD}&quot;]</key>
                            <units>bps</units>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>mca-dump-short.sh[&quot;-d&quot;,&quot;{HOST.CONN}&quot;, &quot;-u&quot;, &quot;{$UNIFI_USER}&quot;, &quot;-i&quot;, &quot;{$UNIFI_SSH_PRIV_KEY_PATH}&quot;, &quot;-t&quot;, &quot;AP&quot;]</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#ESSID}</lld_macro>
                            <path>$.essid</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.vap_table</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$AP_GROUP}</macro>
                    <value>Override me!</value>
                    <description>The name of the group containing the site MAPs</description>
                </macro>
            </macros>
        </template>
    </templates>
    <triggers>
        <trigger>
            <expression>{Unifi Protect NVR4:ssh.run[temp1].last(#1)}&gt;{$UNIFI_ALERT_TEMP} or {Unifi Protect NVR4:ssh.run[temp2].last(#1)}&gt;{$UNIFI_ALERT_TEMP} or {Unifi Protect NVR4:ssh.run[temp3].last(#1)}&gt;{$UNIFI_ALERT_TEMP}</expression>
            <name>{HOST.NAME} is hot</name>
        </trigger>
    </triggers>
    <graphs>
        <graph>
            <name>Air Time</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>UBNT Airmax</host>
                        <key>airTimeSmooth</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Bandwidth</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Unifi UDMP</host>
                        <key>download_bandwidth</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Unifi UDMP</host>
                        <key>upload_bandwidth</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Bandwidth</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Unifi USG</host>
                        <key>download_bandwidth_smooth</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Unifi USG</host>
                        <key>upload_bandwidth_smooth</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Bandwidth Used</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>UBNT Airmax</host>
                        <key>wlanRxBandwidthSmooth</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>UBNT Airmax</host>
                        <key>wlanTxBandwidthSmooth</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>CPU and Memory</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Unifi UDMP</host>
                        <key>cpu</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Unifi UDMP</host>
                        <key>memory</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>CPU and Memory</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Unifi Switch</host>
                        <key>cpu_smooth</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Unifi Switch</host>
                        <key>memory</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>CPU and Memory</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Unifi USG</host>
                        <key>cpu_smooth</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Unifi USG</host>
                        <key>memory</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Latency</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Unifi UDMP</host>
                        <key>wan_latency</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Load Average</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Unifi UDMP</host>
                        <key>loadavg_1</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Unifi UDMP</host>
                        <key>loadavg_5</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>3</sortorder>
                    <color>2774A4</color>
                    <item>
                        <host>Unifi UDMP</host>
                        <key>loadavg_15</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Load Average</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Unifi Switch</host>
                        <key>loadavg_smooth</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Load Average</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Unifi USG</host>
                        <key>loadavg_smooth</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Power I/O</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>2774A4</color>
                    <item>
                        <host>SunMAX SolarPoint</host>
                        <key>net_power_consumption</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Signal and Noise</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>UBNT Airmax</host>
                        <key>noiseSmooth</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>UBNT Airmax</host>
                        <key>signalSmooth</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Total Traffic</name>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Unifi Switch</host>
                        <key>total_rx_bandwidth</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
    </graphs>
</zabbix_export>
