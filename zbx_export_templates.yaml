zabbix_export:
  version: '6.0'
  date: '2022-06-05T01:43:02Z'
  groups:
    -
      uuid: 15155c95a3d048f4856272ae12fd42c5
      name: Patrice
    -
      uuid: e211bc7037224ae698133ce470303670
      name: Unifi
    -
      uuid: 0a316d3d60f64ef8aded36d48dd9d134
      name: unifiZabbix
    -
      uuid: 959165cff290432bbfbea50b4b247b0b
      name: 'Unifi Zabbix Export'
  templates:
    -
      uuid: 3992b5de5504463d9538197893b1fdbc
      template: 'SunMAX SolarPoint'
      name: 'SunMAX SolarPoint'
      groups:
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: 304f50a34a7045dea1314f8317e25a7f
          name: 'Battery Charge'
          type: DEPENDENT
          key: batteryCharge
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.result[1].results.batteries[0].charge'
          master_item:
            key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
          tags:
            -
              tag: Application
              value: Battery
        -
          uuid: 91ff5c8032bd4589895de0596d34aa7b
          name: 'Battery Voltage'
          type: DEPENDENT
          key: batteryVoltage
          delay: '0'
          value_type: FLOAT
          units: V
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.result[1].results.batteries[0].voltage'
            -
              type: MULTIPLIER
              parameters:
                - '0.001'
          master_item:
            key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
          tags:
            -
              tag: Application
              value: Battery
          triggers:
            -
              uuid: 6ab05257f12a4e3b901a348edeba5817
              expression: 'nodata(/SunMAX SolarPoint/batteryVoltage,{$UNIFI_ALERT_PERIOD})=1'
              name: '{HOST.NAME} has not reported data in more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
        -
          uuid: bfda151539714084bd37e8d04c3f544c
          name: 'Net Power Consumption'
          type: CALCULATED
          key: net_power_consumption
          value_type: FLOAT
          units: W
          params: 'last(//pvInputPower) - last(//powerOutput)'
          tags:
            -
              tag: Application
              value: Battery
        -
          uuid: 2ddbf78585f147b7b6e2dc637d5f4e5e
          name: 'Power Output'
          type: DEPENDENT
          key: powerOutput
          delay: '0'
          value_type: FLOAT
          units: W
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.result[1].results.output.power'
            -
              type: MULTIPLIER
              parameters:
                - '0.001'
          master_item:
            key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
          tags:
            -
              tag: Application
              value: Battery
        -
          uuid: 403d912eff154cd7870b795d4c98c1ab
          name: 'Power Input from Solar Array'
          type: DEPENDENT
          key: pvInputPower
          delay: '0'
          value_type: FLOAT
          units: W
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.result[1].results.pv.power'
            -
              type: MULTIPLIER
              parameters:
                - '0.001'
          master_item:
            key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
          tags:
            -
              tag: Application
              value: Battery
        -
          uuid: 143059833e454233a6837519ffede9af
          name: 'Voltage from Solar Array'
          type: DEPENDENT
          key: pvInputVoltage
          delay: '0'
          units: V
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.result[1].results.pv.voltage'
            -
              type: MULTIPLIER
              parameters:
                - '0.001'
          master_item:
            key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
          tags:
            -
              tag: Application
              value: Battery
        -
          uuid: ad7ea49d3203477b96ee03c5984b8870
          name: batteryJson
          type: EXTERNAL
          key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
          history: '0'
          trends: '0'
          value_type: TEXT
          tags:
            -
              tag: Application
              value: Battery
        -
          uuid: 1e16a0bf7ee34ce18fa42567d690c6d7
          name: 'Output Voltage'
          type: DEPENDENT
          key: voltageOutput
          delay: '0'
          value_type: FLOAT
          units: V
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.result[1].results.output.voltage'
            -
              type: MULTIPLIER
              parameters:
                - '0.001'
          master_item:
            key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
          tags:
            -
              tag: Application
              value: Battery
      discovery_rules:
        -
          uuid: 64453202177f47eda7843e639609837d
          name: 'Power Port Discovery'
          type: DEPENDENT
          key: power_port_discovery
          delay: '0'
          item_prototypes:
            -
              uuid: 5ad15ebf54fc45b2a292c3d9e3ea6acd
              name: '{#PORT_NAME} Port Enabled'
              type: DEPENDENT
              key: 'port__enabled_[{#PORT_NAME}]'
              delay: '0'
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.result[1].results.output.pins[ ?(@.name==''{#PORT_NAME}'') ].enabled.first()'
              master_item:
                key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
              tags:
                -
                  tag: Application
                  value: Battery
            -
              uuid: 8f39f76a05ff47aa8e6c8ef55bcebff1
              name: '{#PORT_NAME} Port Low Voltage'
              type: DEPENDENT
              key: 'port__low_voltage_[{#PORT_NAME}]'
              delay: '0'
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.result[1].results.output.pins[ ?(@.name==''{#PORT_NAME}'') ].low_voltage.first()'
              master_item:
                key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
              tags:
                -
                  tag: Application
                  value: Battery
              trigger_prototypes:
                -
                  uuid: 4528ebb39b1345889b79a2241b3945dd
                  expression: 'last(/SunMAX SolarPoint/port__low_voltage_[{#PORT_NAME}],#1)="true"'
                  name: '{#PORT_NAME} Port is in low voltage outage'
                  priority: WARNING
                  manual_close: 'YES'
            -
              uuid: 6e35c0a2518944448151e35b58e9e930
              name: '{#PORT_NAME} Port On'
              type: DEPENDENT
              key: 'port__on_[{#PORT_NAME}]'
              delay: '0'
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.result[1].results.output.pins[ ?(@.name==''{#PORT_NAME}'') ].on.first()'
              master_item:
                key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
              tags:
                -
                  tag: Application
                  value: Battery
            -
              uuid: 2c30b45b07b04756a32e8ccfcf4bacc5
              name: '{#PORT_NAME} Port Suspended'
              type: DEPENDENT
              key: 'port__suspended_[{#PORT_NAME}]'
              delay: '0'
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.result[1].results.output.pins[ ?(@.name==''{#PORT_NAME}'') ].suspended.first()'
              master_item:
                key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
              tags:
                -
                  tag: Application
                  value: Battery
              trigger_prototypes:
                -
                  uuid: 7bd866530508400d99031acd429303f9
                  expression: 'last(/SunMAX SolarPoint/port__suspended_[{#PORT_NAME}],#1)="true"'
                  name: '{#PORT_NAME} Port is Suspended'
                  priority: WARNING
          master_item:
            key: 'solarpointBattery.sh["-u", "{$SOLARPOINT_USERNAME}", "-p", "{$SOLARPOINT_PASSWORD}", {HOST.CONN}]'
          lld_macro_paths:
            -
              lld_macro: '{#PORT_NAME}'
              path: $.name
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.result[1].results.output.pins'
    -
      uuid: 0a98ef31467349b58d955569f2efc963
      template: 'UBNT Airmax'
      name: 'UBNT Airmax'
      groups:
        -
          name: Patrice
        -
          name: unifiZabbix
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: 98f32cb2fb8449a89eb7cf0396995032
          name: airTime
          type: DEPENDENT
          key: airTime
          delay: '0'
          value_type: FLOAT
          units: '%'
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'airTime=(.*)'
                - \1
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Radio
          triggers:
            -
              uuid: e4abdaf9196b4fae98d3de636ac86573
              expression: 'nodata(/UBNT Airmax/airTime,{$UNIFI_ALERT_PERIOD})=1'
              name: '{HOST.NAME} Device has not reported statistics in more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                -
                  name: '{HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'nodata(/Unifi SSH Host/load_avg_1mn,{$UNIFI_ALERT_PERIOD})=1'
        -
          uuid: bb3c7aa6a2ad426e9eadd007eeff6452
          name: 'AirTime Smooth'
          type: CALCULATED
          key: airTimeSmooth
          value_type: FLOAT
          units: '%'
          params: 'avg(//airTime,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: a4cccd4157544aa8a81230333ad1449c
          name: CPU
          type: DEPENDENT
          key: cpuUsage
          delay: '0'
          status: DISABLED
          value_type: FLOAT
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'cpuUsage=(.*)'
                - \1
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: ad7da803e4d94e2b81d1f77b0d2b9950
          name: loadavg
          type: DEPENDENT
          key: loadavg
          delay: '0'
          status: DISABLED
          value_type: FLOAT
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'loadavg=(.*)'
                - \1
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 2bc9a4f3da314707a94150cfe3963051
          name: noise
          type: DEPENDENT
          key: noise
          delay: '0'
          value_type: FLOAT
          units: db
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'noise=(.*)'
                - \1
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 8fd7fbcd72594be7ac5077369f233cdb
          name: 'Noise Smooth'
          type: CALCULATED
          key: noiseSmooth
          value_type: FLOAT
          units: dB
          params: 'avg(//noise,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: f5f349c1a3e549bebff177381fedff9f
          name: signal
          type: DEPENDENT
          key: signal
          delay: '0'
          value_type: FLOAT
          units: db
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'signal=(.*)'
                - \1
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 2d04562fa0774125beef8043875a63ab
          name: 'Signal Smooth'
          type: CALCULATED
          key: signalSmooth
          value_type: FLOAT
          units: dB
          params: 'avg(//signal,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 5fee14bc3d6447fbb7a56c75fecfa907
          name: mca-status
          type: SSH
          key: 'ssh.run[mca-status]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          params: /bin/mca-status
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
        -
          uuid: b0b1603f6ce447a0a77551d8ba293fe8
          name: wlanDownlinkCapacity
          type: DEPENDENT
          key: wlanDownlinkCapacity
          delay: '0'
          units: bps
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'wlanDownlinkCapacity=(.*)'
                - \1
            -
              type: MULTIPLIER
              parameters:
                - '1000'
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 141c618d52af4523810a2053dfc2e07e
          name: 'WAN Downlink Capacity Smooth'
          type: CALCULATED
          key: wlanDownlinkCapacitySmooth
          value_type: FLOAT
          units: bps
          params: 'avg(//wlanDownlinkCapacity,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: c878f4a3a9d14e4290f07c1b9fa1bd86
          name: wlanRxBandwidth
          type: DEPENDENT
          key: wlanRxBandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'wlanRxBytes=(.*)'
                - \1
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 982b5677b12f49bdb0d5be89c4090fa2
          name: 'WAN Reception Bandwidth Smooth'
          type: CALCULATED
          key: wlanRxBandwidthSmooth
          value_type: FLOAT
          units: bps
          params: 'avg(//wlanRxBandwidth,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 35b3f48548f04173a347f5696ed67512
          name: wlanRxErrors
          type: DEPENDENT
          key: wlanRxErrors
          delay: '0'
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'wlanRxErrors=(.*)'
                - \1
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 52a83afd3e694a789073da60506066f7
          name: wlanTxBandwidth
          type: DEPENDENT
          key: wlanTxBandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'wlanTxBytes=(.*)'
                - \1
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: eb50d36ade534adda015c481c883d6ea
          name: 'WAN Transmission Bandwidth Smooth'
          type: CALCULATED
          key: wlanTxBandwidthSmooth
          value_type: FLOAT
          units: bps
          params: 'avg(//wlanTxBandwidth,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 37cd1176cf2c46b39e37d3074f80140a
          name: wlanTxErrors
          type: DEPENDENT
          key: wlanTxErrors
          delay: '0'
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'wlanTxErrors=(.*)'
                - \1
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 1ee6f64675294e7abe57c8754a9392b3
          name: wlanUplinkCapacity
          type: DEPENDENT
          key: wlanUplinkCapacity
          delay: '0'
          units: bps
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'wlanUplinkCapacity=(.*)'
                - \1
            -
              type: MULTIPLIER
              parameters:
                - '1000'
          master_item:
            key: 'ssh.run[mca-status]'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 82b243484217404e94c3ef38f5243af9
          name: 'WAN Uplink Capacity Smooth'
          type: CALCULATED
          key: wlanUplinkCapacitySmooth
          value_type: FLOAT
          units: bps
          params: 'avg(//wlanUplinkCapacity,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Radio
    -
      uuid: a7de22ea581d4acf9dfc99de63c10f9d
      template: 'Unifi AP'
      name: 'Unifi AP'
      description: |
        uses mca-dump via ssh to get AP info.
        
        Assign this template to all APs in your site
      groups:
        -
          name: Patrice
        -
          name: Unifi
        -
          name: unifiZabbix
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: c0502d070bf24f8481781eed09b02e36
          name: 'CPU Utilization'
          type: DEPENDENT
          key: cpu
          delay: '0'
          value_type: FLOAT
          units: '%'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.[''system-stats''].cpu'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 0a6a8fbeb5914c408e3614700e81d6ff
          name: 'CPU Smooth'
          type: CALCULATED
          key: cpu_smooth
          value_type: FLOAT
          units: '%'
          params: 'avg(//cpu,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 3dcc138706314816bb2ddc17c564ac70
          name: Hostname
          type: DEPENDENT
          key: hostname
          delay: '0'
          trends: '0'
          value_type: TEXT
          inventory_link: NAME
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.hostname
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: d5b6cf216295410d8702946b303d9579
          name: mca-dump
          type: EXTERNAL
          key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - mcaDumpError
        -
          uuid: f07faffa28cc416483cf089bb94ec20a
          name: 'Memory Utilization'
          type: CALCULATED
          key: memory
          value_type: FLOAT
          units: '%'
          params: '100* last(//mem_used) / last(//mem_total)'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: f49d35e7e8ec43299f27b8f4b24c042a
          name: 'Total Memory'
          type: DEPENDENT
          key: mem_total
          delay: '0'
          units: bytes
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sys_stats.mem_total
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 67da102d9a6d4145bc7f7888d2c06e16
          name: 'Memory Used'
          type: DEPENDENT
          key: mem_used
          delay: '0'
          units: bytes
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sys_stats.mem_used
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 886f7aa596f2415685213dbe3fcb8dba
          name: Model
          type: DEPENDENT
          key: model
          delay: '0'
          trends: '0'
          value_type: TEXT
          inventory_link: MODEL
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.model_display
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 3c2df9c3ad504a71b43cd3eeaceb4f9d
          name: Satisfaction
          type: DEPENDENT
          key: sat
          delay: '0'
          units: '%'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.satisfaction
            -
              type: STR_REPLACE
              parameters:
                - '-1'
                - '100'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Radio
          triggers:
            -
              uuid: be561d7959ff4054a016af7adfd8b5c7
              expression: 'avg(/Unifi AP/sat,{$UNIFI_ALERT_PERIOD})<70'
              name: '{HOST.NAME} Satisfaction < 70 %'
              priority: INFO
              manual_close: 'YES'
        -
          uuid: 3fef79609a14440e81aaf26bf796e93b
          name: 'Satisfaction Smooth'
          type: CALCULATED
          key: sat_smooth
          value_type: FLOAT
          units: '%'
          params: 'avg(//sat,{$UNIFI_SMOOTHING_PERIOD})'
        -
          uuid: 1485697ffb9a4544b1b1db86704eafa9
          name: Uptime
          type: DEPENDENT
          key: uptime
          delay: '0'
          units: S
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.uptime
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
          triggers:
            -
              uuid: b8c15f7c71934ce89958890a93893a3b
              expression: 'nodata(/Unifi AP/uptime,{$UNIFI_ALERT_PERIOD})=1'
              name: '{HOST.NAME} has not reported statistics in more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                -
                  name: '{HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'max(/Unifi SSH Host/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
                -
                  name: '{HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'nodata(/Unifi SSH Host/load_avg_1mn,{$UNIFI_ALERT_PERIOD})=1'
        -
          uuid: 26900b13cdb742259963690fb57cf251
          name: 'Wireless Reception Bandwidth'
          type: DEPENDENT
          key: wireless_reception_bandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.vap_table.[*].rx_bytes.sum()'
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 7a4ef25185b94148bd006ddb36ab13d6
          name: 'Wireless Reception Bandwidth Smooth'
          type: CALCULATED
          key: wireless_reception_bandwidth_smooth
          value_type: FLOAT
          units: bps
          params: 'avg(//wireless_reception_bandwidth,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 7653b935e51940438db00a20e7ede1e2
          name: 'Wireless Transmission Bandwidth'
          type: DEPENDENT
          key: wireless_transmission_bandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.vap_table.[*].tx_bytes.sum()'
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 28ab515f715446e286ab7a88fe3499d8
          name: 'Wireless Transmission Bandwidth Smooth'
          type: CALCULATED
          key: wireless_transmission_bandwidth_smooth
          value_type: FLOAT
          units: bps
          params: 'avg(//wireless_transmission_bandwidth,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Radio
      discovery_rules:
        -
          uuid: 6e857bdd5a674e4e8be70b0e01d00d1a
          name: 'Active Radio Discovery'
          type: DEPENDENT
          key: active_radio_discovery
          delay: '0'
          lifetime: 1d
          description: 'List all active radios to create channel items'
          item_prototypes:
            -
              uuid: b2ad8503bd71430d93959a6aeb338ed3
              name: 'Channel Number {#RADIO_NAME}'
              type: DEPENDENT
              key: 'channel[{#RADIO_NAME}]'
              delay: '0'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.vap_table[?(@.radio == ''{#RADIO_NAME}'')].channel.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Radio
              trigger_prototypes:
                -
                  uuid: 35674d206a224a61b05c3f570c8c0095
                  expression: 'change(/Unifi AP/channel[{#RADIO_NAME}])<>0'
                  name: '{HOST.NAME}  {#RADIO_NAME} Channel Change'
                  priority: INFO
                  manual_close: 'YES'
            -
              uuid: f35732598f6f4aed84477b0932b496cb
              name: 'Channel Interference {#RADIO_NAME}'
              type: CALCULATED
              key: 'cint[{#RADIO_NAME}]'
              units: '%'
              params: '((last( //cu_total[{#RADIO_NAME}] )- last( //cu_tx[{#RADIO_NAME}])-last(//cu_rx[{#RADIO_NAME}]))>0)*(last( //cu_total[{#RADIO_NAME}] )- last( //cu_tx[{#RADIO_NAME}])-last(//cu_rx[{#RADIO_NAME}]))'
              tags:
                -
                  tag: Application
                  value: Radio
              trigger_prototypes:
                -
                  uuid: 3f72d760eb204eceafe82682fbda16a5
                  expression: 'avg(/Unifi AP/cint[{#RADIO_NAME}],{$UNIFI_ALERT_PERIOD})>{$UNIFI_CHANNEL_INTERFERENCE_AVERAGE_THRESHOLD:"{#RADIO_NAME}"}'
                  name: '{HOST.NAME}  {#RADIO_NAME} Channel Interference > {$UNIFI_CHANNEL_INTERFERENCE_AVERAGE_THRESHOLD:"{#RADIO_NAME}"}%'
                  opdata: '{$UNIFI_CHANNEL_INTERFERENCE_INFO_THRESHOLD:"{#RADIO_NAME"}'
                  priority: AVERAGE
                  manual_close: 'YES'
                -
                  uuid: e774c76335834241b15c4e203889e7e0
                  expression: 'avg(/Unifi AP/cint[{#RADIO_NAME}],{$UNIFI_ALERT_PERIOD})>{$UNIFI_CHANNEL_INTERFERENCE_INFO_THRESHOLD:"{#RADIO_NAME"}'
                  name: '{HOST.NAME}  {#RADIO_NAME} Channel Interference > {$UNIFI_CHANNEL_INTERFERENCE_INFO_THRESHOLD:"{#RADIO_NAME}"}%'
                  opdata: '{$UNIFI_CHANNEL_INTERFERENCE_INFO_THRESHOLD:"{#RADIO_NAME"}'
                  priority: INFO
                  manual_close: 'YES'
                  dependencies:
                    -
                      name: '{HOST.NAME}  {#RADIO_NAME} Channel Interference > {$UNIFI_CHANNEL_INTERFERENCE_AVERAGE_THRESHOLD:"{#RADIO_NAME}"}%'
                      expression: 'avg(/Unifi AP/cint[{#RADIO_NAME}],{$UNIFI_ALERT_PERIOD})>{$UNIFI_CHANNEL_INTERFERENCE_AVERAGE_THRESHOLD:"{#RADIO_NAME}"}'
            -
              uuid: 60ae3f2aea144c1bb42780bc424d7184
              name: 'Channel Reception Utilization {#RADIO_NAME}'
              type: DEPENDENT
              key: 'cu_rx[{#RADIO_NAME}]'
              delay: '0'
              units: '%'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.radio_table[?(@.radio == ''{#RADIO_NAME}'')].athstats.cu_self_rx.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Radio
            -
              uuid: 466eee19400040749764a086133c4342
              name: 'Channel Total Utilization {#RADIO_NAME}'
              type: DEPENDENT
              key: 'cu_total[{#RADIO_NAME}]'
              delay: '0'
              units: '%'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.radio_table[?(@.radio == ''{#RADIO_NAME}'')].athstats.cu_total.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Radio
              trigger_prototypes:
                -
                  uuid: 9047af0eb978454aab5768341986f29b
                  expression: 'avg(/Unifi AP/cu_total[{#RADIO_NAME}],{$UNIFI_ALERT_PERIOD})>{$UNIFI_CHANNEL_USAGE_AVERAGE_THRESHOLD:"{#RADIO_NAME"}'
                  name: '{HOST.NAME}  {#RADIO_NAME} Channel Utilization > {$UNIFI_CHANNEL_USAGE_AVERAGE_THRESHOLD:"{#RADIO_NAME}"}%'
                  opdata: '{$UNIFI_CHANNEL_USAGE_INFO_THRESHOLD:"{#RADIO_NAME}"'
                  priority: AVERAGE
                  manual_close: 'YES'
                -
                  uuid: 69372713ad284b79a905f5942c321b55
                  expression: 'avg(/Unifi AP/cu_total[{#RADIO_NAME}],{$UNIFI_ALERT_PERIOD})>{$UNIFI_CHANNEL_USAGE_INFO_THRESHOLD:"{#RADIO_NAME}"}'
                  name: '{HOST.NAME}  {#RADIO_NAME} Channel Utilization > {$UNIFI_CHANNEL_USAGE_INFO_THRESHOLD:"{#RADIO_NAME}"}%'
                  opdata: '{$UNIFI_CHANNEL_USAGE_INFO_THRESHOLD:"{#RADIO_NAME}"'
                  priority: INFO
                  manual_close: 'YES'
                  dependencies:
                    -
                      name: '{HOST.NAME}  {#RADIO_NAME} Channel Utilization > {$UNIFI_CHANNEL_USAGE_AVERAGE_THRESHOLD:"{#RADIO_NAME}"}%'
                      expression: 'avg(/Unifi AP/cu_total[{#RADIO_NAME}],{$UNIFI_ALERT_PERIOD})>{$UNIFI_CHANNEL_USAGE_AVERAGE_THRESHOLD:"{#RADIO_NAME"}'
            -
              uuid: 11b74b119dea413ea1152b15a8e3eacb
              name: 'Channel Transmission Utilization {#RADIO_NAME}'
              type: DEPENDENT
              key: 'cu_tx[{#RADIO_NAME}]'
              delay: '0'
              units: '%'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.radio_table[?(@.radio == ''{#RADIO_NAME}'')].athstats.cu_self_tx.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Radio
            -
              uuid: 13bbc5518393491eb303198385799fbf
              name: 'Channel Retries {#RADIO_NAME}'
              type: DEPENDENT
              key: 'retries[{#RADIO_NAME}]'
              delay: '0'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.vap_table[?(@.radio == ''{#RADIO_NAME}'')].tx_retries.first()'
                -
                  type: SIMPLE_CHANGE
                  parameters:
                    - ''
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Radio
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          lld_macro_paths:
            -
              lld_macro: '{#RADIO_NAME}'
              path: $.radio
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.radio_table.[?(@.athstats.cu_total >0)]'
        -
          uuid: 90e43b647faa4a6fa7af643960bcf0a5
          name: 'Wifi Network Discovery'
          type: DEPENDENT
          key: wifi_network_discovery
          delay: '0'
          lifetime: 1d
          description: 'Wifi Network Discovery Rule'
          item_prototypes:
            -
              uuid: 99af4e53516341b1b4e40d814fe7a258
              name: '{#ESSID}-{#RADIO_NAME} Rx Bandwidth'
              type: DEPENDENT
              key: 'rx_bandwidth[{#ESSID}-{#RADIO_NAME}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.vap_table.[ ?(@.essid == "{#ESSID}"  && @.radio == "{#RADIO_NAME}") ].tx_bytes.first()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Radio
            -
              uuid: 3748f96463d74affa9340b398c34f1a0
              name: '{#ESSID}-{#RADIO_NAME} Reception Bandwidth Smooth'
              type: CALCULATED
              key: 'rx_bandwidth_smooth[{#ESSID}-{#RADIO_NAME}]'
              value_type: FLOAT
              units: bps
              params: 'avg(//rx_bandwidth[{#ESSID}-{#RADIO_NAME}],{$UNIFI_SMOOTHING_PERIOD})'
              tags:
                -
                  tag: Application
                  value: Radio
            -
              uuid: b18528ee504149118ecc6aac93c51135
              name: '{#ESSID}-{#RADIO_NAME} Tx Bandwidth'
              type: DEPENDENT
              key: 'tx_bandwidth[{#ESSID}-{#RADIO_NAME}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.vap_table.[ ?(@.essid == "{#ESSID}"  && @.radio == "{#RADIO_NAME}") ].tx_bytes.sum()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Radio
            -
              uuid: ec606cedd02f45518d7a0c030b25849e
              name: '{#ESSID}-{#RADIO_NAME} Transmission Bandwidth Smooth'
              type: CALCULATED
              key: 'tx_bandwidth_smooth[{#ESSID}-{#RADIO_NAME}]'
              value_type: FLOAT
              units: bps
              params: 'avg(//tx_bandwidth[{#ESSID}-{#RADIO_NAME}],{$UNIFI_SMOOTHING_PERIOD})'
              tags:
                -
                  tag: Application
                  value: Radio
          graph_prototypes:
            -
              uuid: 27c2c173f4d24b48b7341f0762c727a4
              name: '{#ESSID}-{#RADIO_NAME} Bandwidth'
              graph_items:
                -
                  sortorder: '1'
                  color: 1A7C11
                  item:
                    host: 'Unifi AP'
                    key: 'rx_bandwidth[{#ESSID}-{#RADIO_NAME}]'
                -
                  sortorder: '2'
                  color: F63100
                  item:
                    host: 'Unifi AP'
                    key: 'tx_bandwidth[{#ESSID}-{#RADIO_NAME}]'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          lld_macro_paths:
            -
              lld_macro: '{#ESSID}'
              path: $.essid
            -
              lld_macro: '{#RADIO_NAME}'
              path: $.radio
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.vap_table
      macros:
        -
          macro: '{$UNIFI_LOAD_AVERAGE_HIGH}'
          value: '4'
        -
          macro: '{$UNIFI_LOAD_AVERAGE_MEDIUM}'
          value: '3'
    -
      uuid: 7d97fa717ee745cc8acc35152dfc93de
      template: 'Unifi Protect Camera'
      name: 'Unifi Protect Camera'
      description: 'Assign this to all the protect cameras to track availability and OS versions'
      groups:
        -
          name: Unifi
        -
          name: unifiZabbix
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: 844186fe9f6a45fab4b6d7e328a7a27a
          name: 'Camera Name'
          type: DEPENDENT
          key: camera_name
          delay: '0'
          trends: '0'
          value_type: CHAR
          inventory_link: NAME
          preprocessing:
            -
              type: REGEX
              parameters:
                - '^Linux (\S*)'
                - \1
          master_item:
            key: 'ssh.run[uname]'
        -
          uuid: c5c93a248fa14b7aa37d35db3a0c9fe8
          name: ping
          type: SIMPLE
          key: 'icmpping[]'
          tags:
            -
              tag: Application
              value: Availability
          triggers:
            -
              uuid: c92b0647b8284e2fa9bf10a16821b431
              expression: 'max(/Unifi Protect Camera/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
              name: 'Camera {HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
              manual_close: 'YES'
              tags:
                -
                  tag: Application
                  value: Protect
        -
          uuid: 15a568e6472548a99053c4a8ca9ed924
          name: 'MAC Address'
          type: DEPENDENT
          key: Mac
          delay: '0'
          trends: '0'
          value_type: CHAR
          inventory_link: MACADDRESS_A
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*HWaddr ([a-fA-F0-9:]{17}|[a-fA-F0-9]{12})'
                - \1
          master_item:
            key: 'ssh.run[ifconfig]'
        -
          uuid: cdfa6a9fcacd4ec48cebab6137f5a3e7
          name: 'Outoing Bandwidth Moving Average Threshold'
          type: DEPENDENT
          key: outgoing_bandwidth_moving_average_threshold
          delay: '0'
          units: Bps
          preprocessing:
            -
              type: IN_RANGE
              parameters:
                - '0'
                - '160000000'
              error_handler: CUSTOM_VALUE
              error_handler_params: '8000000'
          master_item:
            key: outgoing_bandwidth_moving_average_threshold_raw
          tags:
            -
              tag: Application
              value: Bandwidth
        -
          uuid: f72f7655c36840f0aa07c339921f4e32
          name: 'Outoing Bandwidth Moving Average Threshold Raw'
          type: CALCULATED
          key: outgoing_bandwidth_moving_average_threshold_raw
          units: Bps
          params: |
            ( 
            last(//tx_bandwidth_smooth,#1:now-1d) +
            last(//tx_bandwidth_smooth,#1:now-2d) +
            last(//tx_bandwidth_smooth,#1:now-3d) +
            last(//tx_bandwidth_smooth,#1:now-4d) +
            last(//tx_bandwidth_smooth,#1:now-5d) +
            last(//tx_bandwidth_smooth,#1:now-6d) +
            last(//tx_bandwidth_smooth,#1:now-7d) 
            
            ) /7 * 0.45
          tags:
            -
              tag: Application
              value: Bandwidth
        -
          uuid: 2cef0436644d43b89057c680ee659c3f
          name: 'Reception Bandwidth'
          type: DEPENDENT
          key: rx_bandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*RX bytes:(\d*)'
                - \1
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'ssh.run[ifconfig]'
          tags:
            -
              tag: Application
              value: Network
        -
          uuid: 0081678ffe614bcd97836a30fd545d87
          name: ifconfig
          type: SSH
          key: 'ssh.run[ifconfig]'
          trends: '0'
          value_type: TEXT
          params: 'if ifconfig eth0 >/dev/null 2>&1 ; then ifconfig eth0; else ifconfig wlan0; fi'
          username: ubnt
          password: '{$PROTECT_CAMERA_PASSWORD}'
          tags:
            -
              tag: Application
              value: Network
          triggers:
            -
              uuid: 2117be829d9e4e34a1307d14cd387cc0
              expression: 'nodata(/Unifi Protect Camera/ssh.run[ifconfig],{$UNIFI_ALERT_PERIOD})=1'
              name: 'Camera {HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                -
                  name: 'Camera {HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'max(/Unifi Protect Camera/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
              tags:
                -
                  tag: Application
                  value: Protect
        -
          uuid: accb9d8274d84bb8857c7d67eb934f21
          name: uname
          type: SSH
          key: 'ssh.run[uname]'
          delay: 1d
          trends: '0'
          value_type: CHAR
          params: 'uname -a'
          username: ubnt
          password: '{$PROTECT_CAMERA_PASSWORD}'
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - '.*No route to host.*'
              error_handler: DISCARD_VALUE
          tags:
            -
              tag: Application
              value: Availability
        -
          uuid: 31105775931e445ca087eb65b0fcd3b1
          name: 'Transmission Bandwidth'
          type: DEPENDENT
          key: tx_bandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*TX bytes:(\d*)'
                - \1
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'ssh.run[ifconfig]'
          tags:
            -
              tag: Application
              value: Network
          triggers:
            -
              uuid: ae881c785d1d4f7d9daf1ce86f0336ac
              expression: 'avg(/Unifi Protect Camera/tx_bandwidth,10m)<{$PROTECT_LOW_BANDWIDTH}'
              name: 'Camera {HOST.NAME} Outgoing Bandwidth Low'
              priority: WARNING
              dependencies:
                -
                  name: 'Camera {HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'max(/Unifi Protect Camera/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
                -
                  name: 'Camera {HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'nodata(/Unifi Protect Camera/ssh.run[ifconfig],{$UNIFI_ALERT_PERIOD})=1'
              tags:
                -
                  tag: Application
                  value: Protect
        -
          uuid: d3577f5041954f47aba9bb8d5c71668e
          name: 'Transmission Bandwidth Smooth'
          type: CALCULATED
          key: tx_bandwidth_smooth
          units: bps
          params: 'avg(//tx_bandwidth,1h)'
          tags:
            -
              tag: Application
              value: Network
    -
      uuid: cb5f1c2aac8d4779b50187acf329d2a3
      template: 'Unifi Protect Cloud Key'
      name: 'Unifi Protect Cloud Key'
      description: 'Assign this template to your Cloud Keys running Protect'
      groups:
        -
          name: Patrice
        -
          name: unifiZabbix
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: 4a94f51e12d747e1a363143c615c6baa
          name: 'Incoming Bandwidth Moving Average Threshold'
          type: CALCULATED
          key: incoming_bandwidth_moving_average_threshold
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          units: bps
          params: |
            (
            avg(//IpExtInOctets,1h:now-1d)+
            avg(//IpExtInOctets,1h:now-2d)+
            avg(//IpExtInOctets,1h:now-3d)+
            avg(//IpExtInOctets,1h:now-4d)+
            avg(//IpExtInOctets,1h:now-5d)+
            avg(//IpExtInOctets,1h:now-6d)+
            avg(//IpExtInOctets,1h:now-7d)
            ) /7*.7
          tags:
            -
              tag: Application
              value: Bandwidth
        -
          uuid: 4f71cb1ac9534508b8b391414ee8345e
          name: 'Incoming Bandwidth'
          type: DEPENDENT
          key: IpExtInOctets
          delay: '0'
          units: bps
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.kernel.IpExtInOctets
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'ssh.run[nstat]'
          tags:
            -
              tag: Application
              value: Network
          triggers:
            -
              uuid: 1e88147fdc28426f9b8d227993f6045e
              expression: 'nodata(/Unifi Protect Cloud Key/IpExtInOctets,{$UNIFI_ALERT_PERIOD})=1'
              name: '{HOST.NAME} hasn''t reported statistics in more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                -
                  name: '{HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'nodata(/Unifi SSH Host/load_avg_1mn,{$UNIFI_ALERT_PERIOD})=1'
            -
              uuid: 7f2a2c7fdad34f378b385eb53e9e08c3
              expression: 'avg(/Unifi Protect Cloud Key/IpExtInOctets,3600s) < 10000'
              name: '{HOST.NAME} Incoming Bandwidth Problem'
              priority: AVERAGE
              manual_close: 'YES'
        -
          uuid: 017f3db264db4c1c801661a46f465e46
          name: nstat
          type: SSH
          key: 'ssh.run[nstat]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          params: 'nstat -j -a'
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          tags:
            -
              tag: Application
              value: Network
        -
          uuid: e1d2e198baa2468fae4e354627b99bcd
          name: 'Web Entry Point'
          type: HTTP_AGENT
          key: web_app
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          trends: '0'
          value_type: TEXT
          url: 'https://{HOST.CONN}:7443'
          retrieve_mode: HEADERS
          triggers:
            -
              uuid: 7aa3a5e7e07244be87bd122c49a916f6
              expression: 'find(/Unifi Protect Cloud Key/web_app,{$UNIFI_ALERT_PERIOD},"like","200")=0'
              name: 'Protect is not running on {HOST.NAME}'
              priority: AVERAGE
    -
      uuid: 5c308fb434614ef8acf2f94a04963cf4
      template: 'Unifi Protect NVR4'
      name: 'Unifi Protect NVR4'
      description: 'Assign this template to your UNVR4s running Protect'
      groups:
        -
          name: Patrice
        -
          name: unifiZabbix
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: 4d686eb0368b42ce8e90e854977e856c
          name: 'CPU Idle'
          type: DEPENDENT
          key: cpu_idle
          delay: '0'
          value_type: FLOAT
          units: '%'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.sysstat.hosts[0].statistics[0].cpuload[0].idle'
          master_item:
            key: 'ssh.run[mpstat_nvr]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: c55a4afc0d3f41f08ed439730558edf0
          name: 'CPU smooth'
          type: CALCULATED
          key: cpu_smooth
          value_type: FLOAT
          units: '%'
          params: 'avg(//cpu_utilization,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: d5b94cccc9994d39b37aef02bbc0550a
          name: 'CPU Utlization'
          type: CALCULATED
          key: cpu_utilization
          value_type: FLOAT
          units: '%'
          params: '100 - last(//cpu_idle)'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 9dcabffea95b4dd48e59fba2e3a2cbff
          name: 'Incoming Bandwidth Moving Average Threshold'
          type: CALCULATED
          key: incoming_bandwidth_moving_average_threshold
          value_type: FLOAT
          units: bps
          params: |
            (
            avg(//IpExtInOctets,1h:now-1d)+
            avg(//IpExtInOctets,1h:now-2d)+
            avg(//IpExtInOctets,1h:now-3d)+
            avg(//IpExtInOctets,1h:now-4d)+
            avg(//IpExtInOctets,1h:now-5d)+
            avg(//IpExtInOctets,1h:now-6d)+
            avg(//IpExtInOctets,1h:now-7d)
            ) /7*.7
          tags:
            -
              tag: Application
              value: Bandwidth
        -
          uuid: 5e773ded65124c77aaadbdc429ef69aa
          name: 'Incoming Bandwidth'
          type: DEPENDENT
          key: IpExtInOctets
          delay: '0'
          units: bps
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.kernel.IpExtInOctets
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'ssh.run[nstat]'
          tags:
            -
              tag: Application
              value: Network
          triggers:
            -
              uuid: e4308a68f1df4a8e9ff7b3692a51355e
              expression: 'nodata(/Unifi Protect NVR4/IpExtInOctets,{$UNIFI_ALERT_PERIOD})=1'
              name: '{HOST.NAME} hasn''t reported statistics for more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                -
                  name: '{HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'max(/Unifi SSH High Priority Host/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
                -
                  name: '{HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'nodata(/Unifi SSH High Priority Host/load_avg_1mn,{$UNIFI_ALERT_PERIOD})=1'
            -
              uuid: 3d4f53db083b401386c1d6e5983f7b54
              expression: 'avg(/Unifi Protect NVR4/IpExtInOctets,1h) < 10000'
              name: '{HOST.NAME} Incoming Bandwidth Problem'
              priority: AVERAGE
              manual_close: 'YES'
        -
          uuid: e466492496544c28a4216331a5613846
          name: nodename
          type: DEPENDENT
          key: nodename
          delay: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.sysstat.hosts[0].nodename'
          master_item:
            key: 'ssh.run[mpstat_nvr]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: b85e01f40dc94e4da492ee6f9d5ca00c
          name: mpstat
          type: SSH
          key: 'ssh.run[mpstat_nvr]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          history: 2d
          trends: '0'
          value_type: CHAR
          params: 'mpstat -o JSON 1 1 | sed ''s/"cpu-load"/"cpuload"/'''
          authtype: PUBLIC_KEY
          username: root
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 705b4fec2f7247fc9a9919a1669376ac
          name: nstat
          type: SSH
          key: 'ssh.run[nstat]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          history: 2d
          trends: '0'
          value_type: TEXT
          params: 'nstat -j -a'
          authtype: PUBLIC_KEY
          username: root
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          tags:
            -
              tag: Application
              value: Network
        -
          uuid: cc50528fc52543a0972b0a325733a22e
          name: 'Temp 1'
          type: SSH
          key: 'ssh.run[temp1]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          value_type: FLOAT
          units: ºC
          params: 'cat /sys/bus/i2c/drivers/adt7475/4-002e/hwmon/hwmon0/device/temp1_input'
          authtype: PUBLIC_KEY
          username: root
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          preprocessing:
            -
              type: MULTIPLIER
              parameters:
                - '0.001'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 88dd5b446d504a84809b2372067e4a40
          name: 'Temp 2'
          type: SSH
          key: 'ssh.run[temp2]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          value_type: FLOAT
          units: ºC
          params: 'cat /sys/bus/i2c/drivers/adt7475/4-002e/hwmon/hwmon0/device/temp2_input'
          authtype: PUBLIC_KEY
          username: root
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          preprocessing:
            -
              type: MULTIPLIER
              parameters:
                - '0.001'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: a0fb6f12fa4c443a8ba281155825bc38
          name: 'Temp 3'
          type: SSH
          key: 'ssh.run[temp3]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          value_type: FLOAT
          units: ºC
          params: 'cat /sys/bus/i2c/drivers/adt7475/4-002e/hwmon/hwmon0/device/temp3_input'
          authtype: PUBLIC_KEY
          username: root
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          preprocessing:
            -
              type: MULTIPLIER
              parameters:
                - '0.001'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 24cac6e713d04af5ac4be614c6829c15
          name: 'Web Entry Point'
          type: HTTP_AGENT
          key: web_app
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          trends: '0'
          value_type: TEXT
          url: 'https://{HOST.CONN}'
          retrieve_mode: HEADERS
          triggers:
            -
              uuid: 0f0a28c883bc43daaa955e6e57d7ee19
              expression: 'find(/Unifi Protect NVR4/web_app,{$UNIFI_ALERT_PERIOD},"like","200")=0'
              name: 'Protect is not running on {HOST.NAME}'
              priority: AVERAGE
    -
      uuid: 0dbc328172e34d8c8b7f3cdfd554d08d
      template: 'Unifi SSH High Priority Host'
      name: 'Unifi SSH High Priority Host'
      description: 'Link this template to NVRs and Gateways'
      groups:
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: fa8381770b744e4b9a717ceef7c569aa
          name: ping
          type: SIMPLE
          key: 'icmpping[]'
          tags:
            -
              tag: Application
              value: Availability
          triggers:
            -
              uuid: d392f22278464ef1bd4936d174f5b0cd
              expression: 'max(/Unifi SSH High Priority Host/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
              name: '{HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
              priority: AVERAGE
              manual_close: 'YES'
        -
          uuid: 18d5b7b413a74fdeb09d1be567c80399
          name: 'Load Average (1mn)'
          type: DEPENDENT
          key: load_avg_1mn
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*load average: ([0-9]+([.][0-9]+))'
                - \1
          master_item:
            key: 'ssh.run[uptime]'
          tags:
            -
              tag: Application
              value: Host
            -
              tag: Application
              value: Performance
          triggers:
            -
              uuid: 08593d21fb5441518507f2470a0acf5e
              expression: 'nodata(/Unifi SSH High Priority Host/load_avg_1mn,{$UNIFI_ALERT_PERIOD})=1'
              name: '{HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
              priority: AVERAGE
              manual_close: 'YES'
              dependencies:
                -
                  name: '{HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'max(/Unifi SSH High Priority Host/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
        -
          uuid: aa7dcd5b4f1a4331a603b3780f31be20
          name: 'Load Average (5mn)'
          type: DEPENDENT
          key: load_avg_5mn
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*load average: [^ ]*, ([0-9]+([.][0-9]+))'
                - \1
          master_item:
            key: 'ssh.run[uptime]'
          tags:
            -
              tag: Application
              value: Host
            -
              tag: Application
              value: Performance
        -
          uuid: c6d1b2905b3f4d29ae9729f32e775368
          name: 'Load Average (15mn)'
          type: DEPENDENT
          key: load_avg_15mn
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*load average: [^ ]*, [^ ]*, ([0-9]+([.][0-9]+))'
                - \1
          master_item:
            key: 'ssh.run[uptime]'
          tags:
            -
              tag: Application
              value: Host
            -
              tag: Application
              value: Performance
        -
          uuid: cbfdeca6e1f8455db6bafe59b8693168
          name: 'MAC Address A'
          type: DEPENDENT
          key: mac_a
          delay: '0'
          trends: '0'
          value_type: CHAR
          inventory_link: MACADDRESS_A
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*HWaddr|ether ([a-fA-F0-9:]{17}|[a-fA-F0-9]{12})'
                - \1
              error_handler: DISCARD_VALUE
          master_item:
            key: 'ssh.run[ifconfig]'
          tags:
            -
              tag: Application
              value: Network
        -
          uuid: d7220ba9c416462fb768ecc14cd75253
          name: 'MAC Address B'
          type: DEPENDENT
          key: mac_b
          delay: '0'
          trends: '0'
          value_type: CHAR
          preprocessing:
            -
              type: REGEX
              parameters:
                - '(HWaddr|ether)(.|\n)*(HWaddr|ether) ([a-fA-F0-9:]{17})'
                - \4
              error_handler: CUSTOM_VALUE
              error_handler_params: N/A
          master_item:
            key: 'ssh.run[ifconfig]'
          tags:
            -
              tag: Application
              value: Network
        -
          uuid: 23e04f2d4e9c4e09925eb8a65f0f41dc
          name: ifconfig
          type: SSH
          key: 'ssh.run[ifconfig]'
          delay: 1h
          history: '0'
          trends: '0'
          value_type: CHAR
          params: '/sbin/ifconfig | grep -A5 {HOST.IP}'
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          tags:
            -
              tag: Application
              value: Network
        -
          uuid: bffe19ef0bca4cb296bf55c9ef69a612
          name: 'Number of processors'
          type: SSH
          key: 'ssh.run[nproc]'
          delay: 1d
          units: Processors
          params: nproc
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          description: 'Number of processors'
          preprocessing:
            -
              type: REGEX
              parameters:
                - '[0-9]'
                - \0
              error_handler: CUSTOM_VALUE
              error_handler_params: '1'
          tags:
            -
              tag: Application
              value: Hardware
            -
              tag: Application
              value: Host
        -
          uuid: 2371bcddb5e64826a68de1ffd034bc1f
          name: uname
          type: SSH
          key: 'ssh.run[uname]'
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          params: 'uname -a'
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          description: 'uname -a'
          inventory_link: OS_FULL
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - '.*No route to host.*'
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Host Unreachable'
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - '.*ssh: command not found.*'
          tags:
            -
              tag: Application
              value: Availability
          triggers:
            -
              uuid: 61e39b8d10334b2eb0673169b3f54510
              expression: 'change(/Unifi SSH High Priority Host/ssh.run[uname])=1'
              name: '{HOST.NAME} Version Change'
              priority: INFO
              manual_close: 'YES'
        -
          uuid: 73f78f9e0e3041f0a258cd41122fe3af
          name: uptime
          type: SSH
          key: 'ssh.run[uptime]'
          history: 2d
          trends: '0'
          value_type: CHAR
          params: uptime
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          description: uptime
          tags:
            -
              tag: Application
              value: Availability
            -
              tag: Application
              value: Performance
    -
      uuid: f87a92acbcb54704a4d23aad9a19ab36
      template: 'Unifi SSH Host'
      name: 'Unifi SSH Host'
      description: |
        Link this template to Unifi APs, Switches, USGes, UDMPs, Airmax devices hosts to get availability and version tracking on top of their specific template.
        
        This will work with any SSH host with basic UNIX on the other side really.
        
        Additionally,. this will fill the OS version and the MAC address in the inventory section.
      groups:
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: d0b8592d9c5d4f55a2531ba748ad8ef2
          name: ping
          type: SIMPLE
          key: 'icmpping[]'
          tags:
            -
              tag: Application
              value: Availability
          triggers:
            -
              uuid: 08a60db01cd24b47bb1802c30c71359c
              expression: 'max(/Unifi SSH Host/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
              name: '{HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
              manual_close: 'YES'
        -
          uuid: fa6026d048bb4efaba7e8b1caa187e82
          name: 'Load Average (1mn)'
          type: DEPENDENT
          key: load_avg_1mn
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*load average: ([0-9]+([.][0-9]+))'
                - \1
          master_item:
            key: 'ssh.run[uptime]'
          tags:
            -
              tag: Application
              value: Host
            -
              tag: Application
              value: Performance
          triggers:
            -
              uuid: 301ff9308c3e4c2f9938a92226b443a5
              expression: 'nodata(/Unifi SSH Host/load_avg_1mn,{$UNIFI_ALERT_PERIOD})=1'
              name: '{HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                -
                  name: '{HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'max(/Unifi SSH Host/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
        -
          uuid: 763b62c5ec40413d97b4e9c127e65f61
          name: 'Load Average (5mn)'
          type: DEPENDENT
          key: load_avg_5mn
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*load average: [^ ]*, ([0-9]+([.][0-9]+))'
                - \1
          master_item:
            key: 'ssh.run[uptime]'
          tags:
            -
              tag: Application
              value: Host
            -
              tag: Application
              value: Performance
        -
          uuid: 1ead0560b5504179b4fededb31e952fa
          name: 'Load Average (15mn)'
          type: DEPENDENT
          key: load_avg_15mn
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*load average: [^ ]*, [^ ]*, ([0-9]+([.][0-9]+))'
                - \1
          master_item:
            key: 'ssh.run[uptime]'
          tags:
            -
              tag: Application
              value: Host
            -
              tag: Application
              value: Performance
        -
          uuid: 18f26cfa53744cbcba3f49581e546436
          name: 'MAC Address A'
          type: DEPENDENT
          key: mac_a
          delay: '0'
          trends: '0'
          value_type: CHAR
          inventory_link: MACADDRESS_A
          preprocessing:
            -
              type: REGEX
              parameters:
                - '.*HWaddr|ether ([a-fA-F0-9:]{17}|[a-fA-F0-9]{12})'
                - \1
              error_handler: DISCARD_VALUE
          master_item:
            key: 'ssh.run[ifconfig]'
          tags:
            -
              tag: Application
              value: Network
        -
          uuid: fb644aff10e7452586bc61429b3bb355
          name: 'MAC Address B'
          type: DEPENDENT
          key: mac_b
          delay: '0'
          trends: '0'
          value_type: CHAR
          preprocessing:
            -
              type: REGEX
              parameters:
                - '(HWaddr|ether)(.|\n)*(HWaddr|ether) ([a-fA-F0-9:]{17})'
                - \4
              error_handler: CUSTOM_VALUE
              error_handler_params: N/A
          master_item:
            key: 'ssh.run[ifconfig]'
          tags:
            -
              tag: Application
              value: Network
        -
          uuid: 2877b47ec7514bb392b4a4ba99c5af18
          name: ifconfig
          type: SSH
          key: 'ssh.run[ifconfig]'
          delay: 1h
          trends: '0'
          value_type: CHAR
          params: '/sbin/ifconfig | grep -A5 {HOST.IP}'
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - '.*No route to host.*'
              error_handler: DISCARD_VALUE
          tags:
            -
              tag: Application
              value: Network
        -
          uuid: ae2f6914da0f4ea7be6de28638e521c9
          name: 'Number of processors'
          type: SSH
          key: 'ssh.run[nproc]'
          delay: 1d
          units: Processors
          params: nproc
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          description: 'Number of processors'
          preprocessing:
            -
              type: REGEX
              parameters:
                - '[0-9]'
                - \0
              error_handler: CUSTOM_VALUE
              error_handler_params: '1'
          tags:
            -
              tag: Application
              value: Hardware
            -
              tag: Application
              value: Host
        -
          uuid: d1c0a1d2e0504e4391d297566e2e8465
          name: uname
          type: SSH
          key: 'ssh.run[uname]'
          delay: 1h
          trends: '0'
          value_type: CHAR
          params: 'uname -a'
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          inventory_link: OS_FULL
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - '.*No route to host.*'
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Host Unreachable'
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - '.*ssh: command not found.*'
          tags:
            -
              tag: Application
              value: Availability
          triggers:
            -
              uuid: 5558237e8dab41a0b5070c3dcf8120a3
              expression: 'change(/Unifi SSH Host/ssh.run[uname])=1'
              name: '{HOST.NAME} Version Change'
              priority: INFO
              manual_close: 'YES'
        -
          uuid: 0cdc86cae6b742e4bf08e06e10d4da1b
          name: 'ssh uptime'
          type: SSH
          key: 'ssh.run[uptime]'
          history: 2d
          trends: '0'
          value_type: CHAR
          params: uptime
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          tags:
            -
              tag: Application
              value: Availability
            -
              tag: Application
              value: Performance
    -
      uuid: 9b6c0fb011ee43549cb49302b36642d8
      template: 'Unifi Switch'
      name: 'Unifi Switch'
      description: 'Link this template to all Unifi switches'
      groups:
        -
          name: Patrice
        -
          name: Unifi
        -
          name: unifiZabbix
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: ba86097608d94aec9f9bd74f965310d7
          name: 'CPU Utilization'
          type: DEPENDENT
          key: cpu
          delay: '0'
          value_type: FLOAT
          units: '%'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.[''system-stats''].cpu'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 5ab9f788137f4ab9a8b38127d52fe141
          name: 'CPU Smooth'
          type: CALCULATED
          key: cpu_smooth
          value_type: FLOAT
          units: '%'
          params: 'avg(//cpu,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 3aab4c5928fe428eaa68c3ded3c966d8
          name: Hostname
          type: DEPENDENT
          key: hostname
          delay: '0'
          trends: '0'
          value_type: TEXT
          inventory_link: NAME
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.hostname
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: c4668b5e15954379bbe9515188d96624
          name: mca-dump
          type: EXTERNAL
          key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - mcaDumpError
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: b7a28c7b13a94f8f9317ba6466c1d4f0
          name: mca-dump-switch-discovery
          type: EXTERNAL
          key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH_DISCOVERY", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          delay: '{$UNIFI_DISCOVERY_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
              error_handler: DISCARD_VALUE
          tags:
            -
              tag: Application
              value: Power
        -
          uuid: 3dbc59ea31d54d20b49a1b8aacbd31b0
          name: mca-dump-feature-discovery
          type: EXTERNAL
          key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH_FEATURE_DISCOVERY", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          delay: '{$UNIFI_DISCOVERY_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
              error_handler: DISCARD_VALUE
          tags:
            -
              tag: Application
              value: Power
        -
          uuid: ac98ab08a67a4bcba69e026763025344
          name: 'Memory Utilization'
          type: CALCULATED
          key: memory
          value_type: FLOAT
          units: '%'
          params: '100* last(//mem_used) / last(//mem_total)'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: f767db4353aa4a24b373bcbd6a804ec1
          name: 'Total Memory'
          type: DEPENDENT
          key: mem_total
          delay: '0'
          units: bytes
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sys_stats.mem_total
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 6a239d18bcac4189a95a6631dc1dbfe3
          name: 'Memory Used'
          type: DEPENDENT
          key: mem_used
          delay: '0'
          units: bytes
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sys_stats.mem_used
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 8be7925af1e84e088375e798ea0a0261
          name: Model
          type: DEPENDENT
          key: model
          delay: '0'
          trends: '0'
          value_type: TEXT
          inventory_link: MODEL
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.model_display
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: d42df9b654fc4a2c88ed8e70106dca82
          name: 'Total Rx Bandwidth'
          type: DEPENDENT
          key: total_rx_bandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.port_table[*].rx_bytes.sum()'
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          tags:
            -
              tag: Application
              value: Traffic
        -
          uuid: e89dd99080734254b3da3423f1b4549c
          name: 'Total Tx Bandwidth'
          type: DEPENDENT
          key: total_tx_bandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.port_table[*].tx_bytes.sum()'
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          tags:
            -
              tag: Application
              value: Traffic
        -
          uuid: 48e7a8ec7bad4aa69a883adbf6564009
          name: Uptime
          type: DEPENDENT
          key: uptime
          delay: '0'
          units: S
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.uptime
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          tags:
            -
              tag: Application
              value: Host
          triggers:
            -
              uuid: 61975534a4404efa8df675da2609c5f2
              expression: 'nodata(/Unifi Switch/uptime,{$UNIFI_ALERT_PERIOD})=1'
              name: '{HOST.NAME} has not reported statistics for more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                -
                  name: '{HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'max(/Unifi SSH Host/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
                -
                  name: '{HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'nodata(/Unifi SSH Host/load_avg_1mn,{$UNIFI_ALERT_PERIOD})=1'
      discovery_rules:
        -
          uuid: c63e03a538104cdebad4f428337e2952
          name: 'Fan Discovery'
          type: DEPENDENT
          key: fan_discovery
          delay: '0'
          item_prototypes:
            -
              uuid: b84302d8102645eb882c4cec6131dddc
              name: 'Fan Level'
              type: DEPENDENT
              key: '_[{#FAN_LEVEL_KEY_NAME}]'
              delay: '0'
              units: '%'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.fan_level
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Power
          graph_prototypes:
            -
              uuid: d1e7161d8eb141b293eacfe4f5305c09
              name: 'Fan Level'
              graph_items:
                -
                  color: 1A7C11
                  calc_fnc: ALL
                  item:
                    host: 'Unifi Switch'
                    key: '_[{#FAN_LEVEL_KEY_NAME}]'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH_FEATURE_DISCOVERY", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          lld_macro_paths:
            -
              lld_macro: '{#FAN_LEVEL_KEY_NAME}'
              path: $.fan_level_key_name
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$[?(@.has_fan=="true")]'
        -
          uuid: 3440ec98490a4b40bcc1dddca0955cb8
          name: 'POE Discovery'
          type: DEPENDENT
          key: poe_discovery
          delay: '0'
          item_prototypes:
            -
              uuid: 2ae16684b40b44adb53ae3363094beef
              name: 'Max Power'
              type: DEPENDENT
              key: '_[{#MAX_POWER_KEY_NAME}]'
              delay: '0'
              units: W
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.total_max_power
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Power
            -
              uuid: a8f107c6ff074de28b110c188b139f79
              name: 'Percent Power Consumed'
              type: CALCULATED
              key: '_[{#PERCENT_POWER_CONSUMED_KEY_NAME}]'
              params: '100 * last(//_[{#TOTAL_POWER_CONSUMED_KEY_NAME}]) / last(//_[{#MAX_POWER_KEY_NAME}])'
              tags:
                -
                  tag: Application
                  value: Power
            -
              uuid: 318b0db443194b53afe55ccbda40bd4c
              name: 'Total Power Consumed'
              type: DEPENDENT
              key: '_[{#TOTAL_POWER_CONSUMED_KEY_NAME}]'
              delay: '0'
              value_type: FLOAT
              units: W
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[*].poe_power.sum()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Power
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH_FEATURE_DISCOVERY", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          lld_macro_paths:
            -
              lld_macro: '{#MAX_POWER_KEY_NAME}'
              path: $.max_power_key_name
            -
              lld_macro: '{#PERCENT_POWER_CONSUMED_KEY_NAME}'
              path: $.percent_power_consumed_key_name
            -
              lld_macro: '{#TOTAL_POWER_CONSUMED_KEY_NAME}'
              path: $.total_power_consumed_key_name
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$[?(@.power=="true")]'
        -
          uuid: ccacdb7fcb1c41d1a3e58f7a201e6603
          name: 'POE Discovery by Port'
          type: DEPENDENT
          key: poe_discovery_by_port
          delay: '0'
          item_prototypes:
            -
              uuid: 1793fb114e2d4fa3b40820d8c51e1d51
              name: 'Power Consumed Port {#PORT_IDX}'
              type: DEPENDENT
              key: 'power_consumed_port[{#PORT_IDX}]'
              delay: '0'
              value_type: FLOAT
              units: W
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table.[ ?(@.port_idx==''{#PORT_IDX}'') ].poe_power.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Power
          graph_prototypes:
            -
              uuid: e919a515e0b14d94aa0f3424f790c5a2
              name: 'Power Consumed by Port {#PORT_IDX}'
              graph_items:
                -
                  sortorder: '1'
                  color: 1A7C11
                  item:
                    host: 'Unifi Switch'
                    key: 'power_consumed_port[{#PORT_IDX}]'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          lld_macro_paths:
            -
              lld_macro: '{#PORT_IDX}'
              path: $.port_idx
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.port_table[?(@.poe_power>=0)]'
        -
          uuid: 2363ae0485a84853af24157aab6ed5f5
          name: 'Switch Port Discovery'
          type: DEPENDENT
          key: switch_port_discovery
          delay: '0'
          item_prototypes:
            -
              uuid: 2a70d96ce61f4e7facfd66e0acbad45e
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} {#PORT_DESC} Connection Speed'
              type: DEPENDENT
              key: 'connection_speed_[{#PORT_IDX}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].speed.first()'
                -
                  type: MULTIPLIER
                  parameters:
                    - '1000000'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: 23118e1970b442b5a3b5f5645e48b6ad
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} {#PORT_DESC} Uplink'
              type: DEPENDENT
              key: 'is_uplink_[{#PORT_IDX}]'
              delay: '0'
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: CHECK_JSON_ERROR
                  parameters:
                    - $.mcaDumpError
                  error_handler: DISCARD_VALUE
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].is_uplink.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: 05486e2ab46b41dca2e917db1211e680
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} {#PORT_DESC} Rx Bandwidth'
              type: DEPENDENT
              key: 'rx_port_[{#PORT_IDX}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].rx_bytes.first()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: a3e991eb253e4b6487dcef2fc1f11ca3
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} {#PORT_DESC} STP State'
              type: DEPENDENT
              key: 'stp_state_[{#PORT_IDX}]'
              delay: '0'
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].stp_state.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: 6aa38f9c842746d0a77edb81dbf7d955
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} {#PORT_DESC} Tx Bandwidth'
              type: DEPENDENT
              key: 'tx_port_[{#PORT_IDX}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].tx_bytes.first()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: e39e30dea20544a8948f05f20155df79
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} {#PORT_DESC} Up'
              type: DEPENDENT
              key: 'up_[{#PORT_IDX}]'
              delay: '0'
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].up.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Traffic
          trigger_prototypes:
            -
              uuid: 2bb9f140e9254b83b86f5318fd3a5240
              expression: 'last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)>0 and last(/Unifi Switch/up_[{#PORT_IDX}],#1)="true" and last(/Unifi Switch/stp_state_[{#PORT_IDX}],#1)="forwarding" and ( avg(/Unifi Switch/rx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)*{$UNIFI_PORT_USAGE_AVERAGE_THRESHOLD}/100 or avg(/Unifi Switch/tx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)*{$UNIFI_PORT_USAGE_AVERAGE_THRESHOLD}/100 )'
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} above {$UNIFI_PORT_USAGE_AVERAGE_THRESHOLD}%'
              priority: AVERAGE
            -
              uuid: ce61140da14e4a1ea919f2e083ee6835
              expression: 'last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)>0 and last(/Unifi Switch/up_[{#PORT_IDX}],#1)="true" and last(/Unifi Switch/stp_state_[{#PORT_IDX}],#1)="forwarding" and ( avg(/Unifi Switch/rx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)*{$UNIFI_PORT_USAGE_INFO_THRESHOLD}/100 or avg(/Unifi Switch/tx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)*{$UNIFI_PORT_USAGE_INFO_THRESHOLD}/100 )'
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} above {$UNIFI_PORT_USAGE_INFO_THRESHOLD}%'
              priority: INFO
              dependencies:
                -
                  name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} above {$UNIFI_PORT_USAGE_WARNING_THRESHOLD}%'
                  expression: 'last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)>0 and last(/Unifi Switch/up_[{#PORT_IDX}],#1)="true" and last(/Unifi Switch/stp_state_[{#PORT_IDX}],#1)="forwarding" and (  avg(/Unifi Switch/rx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)*{$UNIFI_PORT_USAGE_WARNING_THRESHOLD}/100 or avg(/Unifi Switch/tx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)*{$UNIFI_PORT_USAGE_WARNING_THRESHOLD}/100 )'
            -
              uuid: 054404edaf6b444a9c293b68a48a9adf
              expression: 'last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)>0 and last(/Unifi Switch/up_[{#PORT_IDX}],#1)="true" and last(/Unifi Switch/stp_state_[{#PORT_IDX}],#1)="forwarding" and (  avg(/Unifi Switch/rx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)*{$UNIFI_PORT_USAGE_WARNING_THRESHOLD}/100 or avg(/Unifi Switch/tx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)*{$UNIFI_PORT_USAGE_WARNING_THRESHOLD}/100 )'
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} above {$UNIFI_PORT_USAGE_WARNING_THRESHOLD}%'
              priority: WARNING
              dependencies:
                -
                  name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} above {$UNIFI_PORT_USAGE_AVERAGE_THRESHOLD}%'
                  expression: 'last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)>0 and last(/Unifi Switch/up_[{#PORT_IDX}],#1)="true" and last(/Unifi Switch/stp_state_[{#PORT_IDX}],#1)="forwarding" and ( avg(/Unifi Switch/rx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)*{$UNIFI_PORT_USAGE_AVERAGE_THRESHOLD}/100 or avg(/Unifi Switch/tx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi Switch/connection_speed_[{#PORT_IDX}],#1)*{$UNIFI_PORT_USAGE_AVERAGE_THRESHOLD}/100 )'
          graph_prototypes:
            -
              uuid: 573a52f59a844f798b12c86c12a7acd4
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} Port I/O'
              graph_items:
                -
                  sortorder: '1'
                  color: 1A7C11
                  item:
                    host: 'Unifi Switch'
                    key: 'rx_port_[{#PORT_IDX}]'
                -
                  sortorder: '2'
                  color: F63100
                  item:
                    host: 'Unifi Switch'
                    key: 'tx_port_[{#PORT_IDX}]'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH_DISCOVERY", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          lld_macro_paths:
            -
              lld_macro: '{#LOCAL_PORT_NAME}'
              path: $.local_port_name
            -
              lld_macro: '{#PORT_DESC}'
              path: $.port_desc
            -
              lld_macro: '{#PORT_IDX}'
              path: $.port_idx
            -
              lld_macro: '{#PORT_IS_UPLINK}'
              path: $.is_uplink
            -
              lld_macro: '{#PORT_MEDIA}'
              path: $.media
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.port_table
        -
          uuid: a520f7c4997947a4865af775a70e1ac7
          name: 'Temperature Discovery'
          type: DEPENDENT
          key: temperature_discovery
          delay: '0'
          item_prototypes:
            -
              uuid: bb33a8f4a3ad4b44b1171de47669577e
              name: Overheating
              type: DEPENDENT
              key: '_[{#OVERHEATING_KEY_NAME}]'
              delay: '0'
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.overheating
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Power
            -
              uuid: 1ee44c1518f441bd9ad5d3c585049926
              name: Temperature
              type: DEPENDENT
              key: '_[{#TEMPERATURE_KEY_NAME}]'
              delay: '0'
              value_type: FLOAT
              units: ºC
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.general_temperature
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
              tags:
                -
                  tag: Application
                  value: Power
          graph_prototypes:
            -
              uuid: b6431556a31941d29b7b592c57342e4d
              name: Temperature
              graph_items:
                -
                  color: 1A7C11
                  calc_fnc: ALL
                  item:
                    host: 'Unifi Switch'
                    key: '_[{#TEMPERATURE_KEY_NAME}]'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "SWITCH_FEATURE_DISCOVERY", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}"]'
          lld_macro_paths:
            -
              lld_macro: '{#OVERHEATING_KEY_NAME}'
              path: $.overheating_key_name
            -
              lld_macro: '{#TEMPERATURE_KEY_NAME}'
              path: $.temperature_key_name
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$[?(@.has_temperature=="true")]'
      macros:
        -
          macro: '{$UNIFI_LOAD_AVERAGE_HIGH}'
          value: '5'
        -
          macro: '{$UNIFI_LOAD_AVERAGE_MEDIUM}'
          value: '4'
    -
      uuid: 8838e1f9216740ef85fc1dcd9aa40470
      template: 'Unifi UDMP'
      name: 'Unifi UDMP'
      description: 'Link this template to UDMPs'
      groups:
        -
          name: Patrice
        -
          name: unifiZabbix
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: 18f6381b1c3648b297fbcd37afd8c4b6
          name: 'CPU Utilization'
          type: DEPENDENT
          key: cpu
          delay: '0'
          value_type: FLOAT
          units: '%'
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.[''system-stats''].cpu'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 9204754ee4064cdb86e7363d0712bbd3
          name: 'CPU Smooth'
          type: CALCULATED
          key: cpu_smooth
          value_type: FLOAT
          units: '%'
          params: 'avg(//cpu,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 37128fdaf8a44d3ca2dd43030aeda754
          name: 'Download Bandwidth'
          type: DEPENDENT
          key: download_bandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].rx_bytes.first()'
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: afe932a0c79e417ca73a2ab03d7b7c51
          name: 'Download Bandwidth Smooth'
          type: CALCULATED
          key: download_bandwidth_smooth
          value_type: FLOAT
          units: bps
          params: 'avg(//download_bandwidth,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 3f6a016441704b88bf6e46b8e7197978
          name: 'Dropped Dowmload Packets'
          type: DEPENDENT
          key: dropped_download_packets
          delay: '0'
          units: packet
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].rx_dropped.first()'
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 429298f385a04a27b174f4043179c6c1
          name: 'Dropped Upload Packets'
          type: DEPENDENT
          key: dropped_upload_packets
          delay: '0'
          units: packet
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].tx_dropped.first()'
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 8c6a8688114c426a8a6c7df47e295239
          name: 'Error Download Packets'
          type: DEPENDENT
          key: error_download_packets
          delay: '0'
          units: packet
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].rx_errors.first()'
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: f7dec452d1d4457ca0bf5acf2b60190f
          name: 'Error Upload Packets'
          type: DEPENDENT
          key: error_upload_packets
          delay: '0'
          units: packet
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].tx_errors.first()'
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 8e27edf5a301436ba32463a2fd615e44
          name: 'Fan Speed'
          type: DEPENDENT
          key: fanSpeed
          delay: '0'
          units: rpm
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'fan1:[ ]+([0-9]+) RPM'
                - \1
          master_item:
            key: 'ssh.run[sensors]'
        -
          uuid: e205941cf309403cb90a79a2c77c79db
          name: Hostname
          type: DEPENDENT
          key: hostname
          delay: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $.hostname
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 0340d3a39faf4ab9a318780d4514aa3c
          name: 'Hourly Direct Port 53 Requests'
          type: CALCULATED
          key: hourly_port_53_requests
          history: 21d
          params: 'count(//port_53_abuser_request,3600s)'
          tags:
            -
              tag: Application
              value: DNS
        -
          uuid: 0a0bd902e984402bb28fa7e7506f4471
          name: 'Port 53 Abuser Request Raw'
          type: ZABBIX_ACTIVE
          key: 'logrt["/mnt/data/log/messages(\.[0-9])?","user.warn kernel.*SRC=(([0-9]{1,3}\.){3}[0-9]{1,3}) DST=(([0-9]{1,3}\.){3}[0-9]{1,3}).*DPT=8?53 .*",,,,"[ { \"ip\": \"\1\", \"dns_server\":\"\3\" } ]"]'
          history: '0'
          trends: '0'
          status: DISABLED
          value_type: TEXT
          tags:
            -
              tag: Application
              value: DNS
        -
          uuid: 8eb698db79b94fa18684ebcee01876b7
          name: mca-dump
          type: EXTERNAL
          key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - mcaDumpError
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: edc477cd12ed4a09b0229145ab0dac8b
          name: 'Memory Utilization'
          type: CALCULATED
          key: memory
          value_type: FLOAT
          units: '%'
          params: '100* last(//mem_used) / last(//mem_total)'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 6d11b4ee4bfd4e46876003b76ab98f8b
          name: 'Total Memory'
          type: DEPENDENT
          key: mem_total
          delay: '0'
          units: bytes
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $.sys_stats.mem_total
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: fc15813aadcf4ab0a7fce520edead1d0
          name: 'Memory Used'
          type: DEPENDENT
          key: mem_used
          delay: '0'
          units: bytes
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sys_stats.mem_used
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: ce371d643fa241f08754f455091c7f12
          name: Model
          type: DEPENDENT
          key: model
          delay: '0'
          trends: '0'
          value_type: TEXT
          inventory_link: MODEL
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.model_display
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 974499717ff54afb888c14d7a32c5f1a
          name: 'Port 53 Abuser Request'
          type: DEPENDENT
          key: port_53_abuser_request
          delay: '0'
          trends: '0'
          value_type: CHAR
          master_item:
            key: 'logrt["/mnt/data/log/messages(\.[0-9])?","user.warn kernel.*SRC=(([0-9]{1,3}\.){3}[0-9]{1,3}) DST=(([0-9]{1,3}\.){3}[0-9]{1,3}).*DPT=8?53 .*",,,,"[ { \"ip\": \"\1\", \"dns_server\":\"\3\" } ]"]'
          tags:
            -
              tag: Application
              value: DNS
        -
          uuid: 46eb9ca1f2c64ae09304bd11f695589f
          name: sensors
          type: SSH
          key: 'ssh.run[sensors]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          params: sensors
          authtype: PUBLIC_KEY
          username: '{$UNIFI_USER}'
          publickey: '{$UNIFI_PUB_KEY}'
          privatekey: '{$UNIFI_PRIV_KEY}'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 81add4b3efd84047b264ff48f98aff53
          name: 'Temp 1'
          type: DEPENDENT
          key: temp1
          delay: '0'
          value_type: FLOAT
          units: ºC
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'temp1:[ ]+\+([0-9]+\.[0-9]) C'
                - \1
          master_item:
            key: 'ssh.run[sensors]'
        -
          uuid: c55c2e9872e844f19c9aa535454baf74
          name: 'Temperature CPU'
          type: DEPENDENT
          key: temperature.cpu
          delay: '0'
          value_type: FLOAT
          units: ºC
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.temperatures.[?(@.name == ''CPU'')].value.first()'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 3f57027299814f168fae8f8abdc621c1
          name: 'Temperature PHY'
          type: DEPENDENT
          key: temperature.phy
          delay: '0'
          value_type: FLOAT
          units: ºC
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.temperatures.[?(@.name == ''PHY'')].value.first()'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: ff07a3572bfa4f089c7abf60cdc45163
          name: 'Total Switch Rx Bandwidth'
          type: DEPENDENT
          key: total_switch_rx_bandwidth
          delay: '0'
          units: bps
          description: 'Total Bandwidth Received by the 8 port switch embedded in the UDMP (ports 1-8)'
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.port_table[?(@.port_idx < 9)].rx_bytes.sum()'
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Traffic
        -
          uuid: 1ef97d3bf6b84e179d80ffe44c00bb40
          name: 'Total Switch Tx Bandwidth'
          type: DEPENDENT
          key: total_switch_tx_bandwidth
          delay: '0'
          units: bps
          description: 'Total Bandwidth Sent by the 8 port switch embedded in the UDMP (ports 1-8)'
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.port_table[?(@.port_idx < 9)].tx_bytes.sum()'
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Traffic
        -
          uuid: b5b81d4dab514d4680b987094da82541
          name: 'Upload Bandwidth'
          type: DEPENDENT
          key: upload_bandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].tx_bytes.first()'
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 5e6cf6da2cb44182baaba87fe67ca65b
          name: 'Upload Bandwidth Smooth'
          type: CALCULATED
          key: upload_bandwidth_smooth
          value_type: FLOAT
          units: bps
          params: 'avg(//upload_bandwidth,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: ba7054579a914ad4aa25941fc192c3aa
          name: Uptime
          type: DEPENDENT
          key: uptime
          delay: '0'
          units: S
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $.uptime
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: Host
          triggers:
            -
              uuid: b592d4299ef9482496c585caa936112c
              expression: 'nodata(/Unifi UDMP/uptime,{$UNIFI_ALERT_PERIOD})=1'
              name: '{HOST.NAME} has not report statistics for more than {$UNIFI_ALERT_PERIOD}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                -
                  name: '{HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'nodata(/Unifi SSH High Priority Host/load_avg_1mn,{$UNIFI_ALERT_PERIOD})=1'
        -
          uuid: 8d57c1175b0b4f74b2d0add7c66a4e22
          name: 'WAN Latency'
          type: DEPENDENT
          key: wan_latency
          delay: '0'
          units: ms
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].latency.first()'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 1a7dca58d5974370b682310f019b78cf
          name: 'Wan Latency Smooth'
          type: CALCULATED
          key: wan_latency_smooth
          value_type: FLOAT
          units: ms
          params: 'avg(//wan_latency,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: wan
      discovery_rules:
        -
          uuid: 85739b2b715a4246a543ebfdaa9aeb73
          name: 'Network Discovery'
          type: DEPENDENT
          key: network_discovery
          delay: '0'
          description: 'Network Discovery'
          item_prototypes:
            -
              uuid: 3120f764520c4881af4d5f84116dacb1
              name: '{#NETWORK_NAME} VLAN Reception Bandwidth'
              type: DEPENDENT
              key: 'vlan_rx_bandwitdh[{#NETWORK_NAME}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: CHECK_JSON_ERROR
                  parameters:
                    - $.mcaDumpError
                -
                  type: JSONPATH
                  parameters:
                    - '$.network_table[ ?(@.address == ''{#NETWORK_NAME}'' ) ].stats.rx_bytes.first()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: cf0082a5d087409d8bf36cf4f9b954ae
              name: '{#NETWORK_NAME} VLAN Transmission Bandwidth'
              type: DEPENDENT
              key: 'vlan_tx_bandwitdh[{#NETWORK_NAME}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: CHECK_JSON_ERROR
                  parameters:
                    - $.mcaDumpError
                -
                  type: JSONPATH
                  parameters:
                    - '$.network_table[ ?(@.address == ''{#NETWORK_NAME}'' ) ].stats.tx_bytes.first()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Traffic
          graph_prototypes:
            -
              uuid: 7a62b41d75314aea883418cf203a38d9
              name: '{#NETWORK_NAME} Inter-VLAN Bandwidth'
              graph_items:
                -
                  sortorder: '1'
                  color: 1A7C11
                  item:
                    host: 'Unifi UDMP'
                    key: 'vlan_rx_bandwitdh[{#NETWORK_NAME}]'
                -
                  sortorder: '2'
                  color: F63100
                  item:
                    host: 'Unifi UDMP'
                    key: 'vlan_tx_bandwitdh[{#NETWORK_NAME}]'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          lld_macro_paths:
            -
              lld_macro: '{#NETWORK_NAME}'
              path: $.address
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.network_table[?(@.active_dhcp_lease_count>0)]'
        -
          uuid: 8f93ed4e9efa4b13ad9df0cc0766a4cc
          name: 'Port 53 discovery abuser'
          type: DEPENDENT
          key: port_53_abuser_discovery
          delay: '0'
          lifetime: 2d
          item_prototypes:
            -
              uuid: 492f7deff4c44b699b3f79fbd89f4c83
              name: 'Hourly Port 53 Requests from {#ABUSER}'
              type: CALCULATED
              key: 'hourly_port_53_requests_[{#ABUSER}]'
              value_type: FLOAT
              params: 'count(//port_53_abuser_request,3600s,"like","\"{#ABUSER}\"")'
              tags:
                -
                  tag: Application
                  value: DNS
          master_item:
            key: 'logrt["/mnt/data/log/messages(\.[0-9])?","user.warn kernel.*SRC=(([0-9]{1,3}\.){3}[0-9]{1,3}) DST=(([0-9]{1,3}\.){3}[0-9]{1,3}).*DPT=8?53 .*",,,,"[ { \"ip\": \"\1\", \"dns_server\":\"\3\" } ]"]'
          lld_macro_paths:
            -
              lld_macro: '{#ABUSER}'
              path: $.ip
            -
              lld_macro: '{#DNS_SERVER}'
              path: $.dns_server
        -
          uuid: a0838ea024db492b8c3d1c904dfb8315
          name: 'Port 53 discovery DNS server'
          type: DEPENDENT
          key: port_53_dns_server_discovery
          delay: '0'
          lifetime: 2d
          item_prototypes:
            -
              uuid: ce121518b98d452fa1e62cac9522d00d
              name: 'Hourly Port 53 Requests to {#DNS_SERVER}'
              type: CALCULATED
              key: 'hourly_port_53_requests_to_[{#DNS_SERVER}]'
              value_type: FLOAT
              params: 'count(//port_53_abuser_request,3600s,"like","\"{#DNS_SERVER}\"")'
              tags:
                -
                  tag: Application
                  value: DNS
          master_item:
            key: 'logrt["/mnt/data/log/messages(\.[0-9])?","user.warn kernel.*SRC=(([0-9]{1,3}\.){3}[0-9]{1,3}) DST=(([0-9]{1,3}\.){3}[0-9]{1,3}).*DPT=8?53 .*",,,,"[ { \"ip\": \"\1\", \"dns_server\":\"\3\" } ]"]'
          lld_macro_paths:
            -
              lld_macro: '{#ABUSER}'
              path: $.ip
            -
              lld_macro: '{#DNS_SERVER}'
              path: $.dns_server
        -
          uuid: 58568f925c7c4f7bb44800d431141b69
          name: 'Site to Site VPN Discovery'
          type: DEPENDENT
          key: site_to_site_vpn_discovery
          delay: '0'
          item_prototypes:
            -
              uuid: c797de40215b4b99a2e6fec77cbf6d6e
              name: 'Remote Site Rx Bandwidth - {#REMOTE_SITE_IP}'
              type: DEPENDENT
              key: 'remote_site_rx_bandwitdh[{#REMOTE_SITE_IP}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: CHECK_JSON_ERROR
                  parameters:
                    - $.mcaDumpError
                -
                  type: JSONPATH
                  parameters:
                    - '$.vpn[*].remotes[?(@.ip  == ''{#REMOTE_SITE_IP}'')].rxRate.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: 699f174819c64cf79820addab60c3a67
              name: 'Remote Site Tx Bandwidth - {#REMOTE_SITE_IP}'
              type: DEPENDENT
              key: 'remote_site_tx_bandwitdh[{#REMOTE_SITE_IP}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: CHECK_JSON_ERROR
                  parameters:
                    - $.mcaDumpError
                -
                  type: JSONPATH
                  parameters:
                    - '$.vpn[*].remotes[?(@.ip  == ''{#REMOTE_SITE_IP}'')].txRate.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Traffic
          graph_prototypes:
            -
              uuid: 25bf1af2bd6b4629bd724b6251d197c1
              name: 'Remote Site Bandwidth - {#REMOTE_SITE_IP}'
              graph_items:
                -
                  sortorder: '1'
                  color: 1A7C11
                  item:
                    host: 'Unifi UDMP'
                    key: 'remote_site_rx_bandwitdh[{#REMOTE_SITE_IP}]'
                -
                  sortorder: '2'
                  color: F63100
                  item:
                    host: 'Unifi UDMP'
                    key: 'remote_site_tx_bandwitdh[{#REMOTE_SITE_IP}]'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          lld_macro_paths:
            -
              lld_macro: '{#REMOTE_SITE_IP}'
              path: $.ip
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.vpn[*].remotes[0]'
        -
          uuid: c4593426190a422dbdf3341a066c4214
          name: 'Switch Port Discovery'
          type: DEPENDENT
          key: switch_port_discovery
          delay: '0'
          item_prototypes:
            -
              uuid: 679a3e2856dd46c6a966843c44738a5b
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} Connection Speed'
              type: DEPENDENT
              key: 'connection_speed_[{#PORT_IDX}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].speed.first()'
                -
                  type: MULTIPLIER
                  parameters:
                    - '1000000'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: 1b52fd26f9654509a911f6a43d8658ab
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} Uplink'
              type: DEPENDENT
              key: 'is_uplink_[{#PORT_IDX}]'
              delay: '0'
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: CHECK_JSON_ERROR
                  parameters:
                    - $.mcaDumpError
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].is_uplink.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: 0d02ff3c40e94f4b9c0495fafc3f9a1c
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} Rx Bandwidth'
              type: DEPENDENT
              key: 'rx_port_[{#PORT_IDX}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].rx_bytes.first()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: 78a554f976144a7ea4db83051148a91b
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} Tx Bandwidth'
              type: DEPENDENT
              key: 'tx_port_[{#PORT_IDX}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].tx_bytes.first()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: c42462fcfe1e47b4abc2ca083d18d458
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} Up'
              type: DEPENDENT
              key: 'up_[{#PORT_IDX}]'
              delay: '0'
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: CHECK_JSON_ERROR
                  parameters:
                    - $.mcaDumpError
                -
                  type: JSONPATH
                  parameters:
                    - '$.port_table[ ?(@.port_idx==''{#PORT_IDX}'')].up.first()'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
              tags:
                -
                  tag: Application
                  value: Traffic
          trigger_prototypes:
            -
              uuid: 6e678d3587d944b8bb4a87b7a5ef5935
              expression: 'last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)>0 and last(/Unifi UDMP/up_[{#PORT_IDX}],#1)="true" and ( avg(/Unifi UDMP/rx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)*.25 or avg(/Unifi UDMP/tx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)*.25 )'
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} above 25%'
              priority: INFO
              dependencies:
                -
                  name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} above 50%'
                  expression: 'last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)>0 and last(/Unifi UDMP/up_[{#PORT_IDX}],#1)="true" and (  avg(/Unifi UDMP/rx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)*.5 or avg(/Unifi UDMP/tx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)*.5 )'
            -
              uuid: 14c2ce7629714ff38b1ed1fcaae6ebd3
              expression: 'last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)>0 and last(/Unifi UDMP/up_[{#PORT_IDX}],#1)="true" and (  avg(/Unifi UDMP/rx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)*.5 or avg(/Unifi UDMP/tx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)*.5 )'
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} above 50%'
              priority: WARNING
              dependencies:
                -
                  name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} above 75%'
                  expression: 'last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)>0 and last(/Unifi UDMP/up_[{#PORT_IDX}],#1)="true" and ( avg(/Unifi UDMP/rx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)*.75 or avg(/Unifi UDMP/tx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)*.75 )'
            -
              uuid: 37beea9d4c814e8f8818ddc65c207e3c
              expression: 'last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)>0 and last(/Unifi UDMP/up_[{#PORT_IDX}],#1)="true" and ( avg(/Unifi UDMP/rx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)*.75 or avg(/Unifi UDMP/tx_port_[{#PORT_IDX}],{$UNIFI_ALERT_PERIOD})>last(/Unifi UDMP/connection_speed_[{#PORT_IDX}],#1)*.75 )'
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} above 75%'
              priority: AVERAGE
          graph_prototypes:
            -
              uuid: 877968bc3fbb4d2daf2421e3e4b31569
              name: '{{#PORT_IS_UPLINK}.regsub("true", "Uplink")} {{#PORT_MEDIA}.regsub("SFP", \0)} Port {#PORT_IDX} Port I/O'
              graph_items:
                -
                  sortorder: '1'
                  color: 1A7C11
                  item:
                    host: 'Unifi UDMP'
                    key: 'rx_port_[{#PORT_IDX}]'
                -
                  sortorder: '2'
                  color: F63100
                  item:
                    host: 'Unifi UDMP'
                    key: 'tx_port_[{#PORT_IDX}]'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "root", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "UDMP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}"  ]'
          lld_macro_paths:
            -
              lld_macro: '{#LOCAL_PORT_NAME}'
              path: $.local_port_name
            -
              lld_macro: '{#PORT_IDX}'
              path: $.port_idx
            -
              lld_macro: '{#PORT_IS_UPLINK}'
              path: $.is_uplink
            -
              lld_macro: '{#PORT_MEDIA}'
              path: $.media
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $.port_table
      macros:
        -
          macro: '{$UNIFI_USER}'
          value: root
          description: 'AP Zabbix SSH Username - UDMP only supports root'
    -
      uuid: f15020131b5c4b7b96100df9faedce9c
      template: 'Unifi USG'
      name: 'Unifi USG'
      description: 'Link this template to USGs'
      groups:
        -
          name: Patrice
        -
          name: unifiZabbix
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: 81d276921081468c895ca7c7d9b3e918
          name: 'CPU Utilization'
          type: DEPENDENT
          key: cpu
          delay: '0'
          value_type: FLOAT
          units: '%'
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.[''system-stats''].cpu'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 4412da02249643e5a550d06ec615fba8
          name: 'CPU Smooth'
          type: CALCULATED
          key: cpu_smooth
          value_type: FLOAT
          units: '%'
          params: 'avg(//cpu,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: bd014f86f61b49f9986807955f0ced54
          name: 'Download Bandwidth'
          type: DEPENDENT
          key: download_bandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].rx_bytes.first()'
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 06f18573d1074e1ca3e8a3410718f84c
          name: 'Download Bandwidth Smooth'
          type: CALCULATED
          key: download_bandwidth_smooth
          value_type: FLOAT
          units: bps
          params: 'avg(//download_bandwidth,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: ecf022ac405d40df9eab71535db74efb
          name: 'Dropped Dowload Packets'
          type: DEPENDENT
          key: dropped_dowload_packets
          delay: '0'
          units: packet
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].rx_dropped.first()'
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 25fe82aeddae4bcaaf9200938f5bf374
          name: 'Dropped Upload Packets'
          type: DEPENDENT
          key: dropped_upload_packets
          delay: '0'
          units: packet
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].tx_dropped.first()'
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: ba029bfe37ed46afb282ddf488ad85e2
          name: 'Error Download Packets'
          type: DEPENDENT
          key: error_download_packets
          delay: '0'
          units: packet
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].rx_errors.first()'
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 7c5b5eca37ba42c2be32eb0557911a58
          name: 'Error Upload Packets'
          type: DEPENDENT
          key: error_upload_packets
          delay: '0'
          units: packet
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].tx_errors.first()'
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: a5aeed02d2de40468e2b803199236775
          name: Hostname
          type: DEPENDENT
          key: hostname
          delay: '0'
          trends: '0'
          value_type: TEXT
          inventory_link: NAME
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $.hostname
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 01ee1019a6924fb68849a55218890a6f
          name: mca-dump
          type: EXTERNAL
          key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - mcaDumpError
              error_handler: DISCARD_VALUE
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 4503d713fb44413ea199a63178ad08e2
          name: mca-dump-discovery
          type: EXTERNAL
          key: 'mca-dump-short.sh[ "-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}" ]'
          delay: '{$UNIFI_DISCOVERY_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - mcaDumpError
              error_handler: DISCARD_VALUE
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: b563bf45785f4115aebbe863be59d5b3
          name: 'Memory Utilization'
          type: CALCULATED
          key: memory
          value_type: FLOAT
          units: '%'
          params: '100* last(//mem_used) / last(//mem_total)'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: ea425dc7ad9441e4a98d3dda70d686f0
          name: 'Total Memory'
          type: DEPENDENT
          key: mem_total
          delay: '0'
          units: bytes
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $.sys_stats.mem_total
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 85a3e058622143858b1d03f42e8502ea
          name: 'Memory Used'
          type: DEPENDENT
          key: mem_used
          delay: '0'
          units: bytes
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $.sys_stats.mem_used
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 7b26ad9b743a40a19158e509e8d805a9
          name: Model
          type: DEPENDENT
          key: model
          delay: '0'
          trends: '0'
          value_type: TEXT
          inventory_link: MODEL
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $.model_display
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 8599d352cdda477c80879089f13354d7
          name: 'Temperature CPU'
          type: DEPENDENT
          key: temperature.cpu
          delay: '0'
          units: ºC
          preprocessing:
            -
              type: MATCHES_REGEX
              parameters:
                - mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $..temps.CPU.first()
            -
              type: STR_REPLACE
              parameters:
                - ' C'
                - ''
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 8aff108a17754957b7af5385e653fd46
          name: 'Temperature PHY'
          type: DEPENDENT
          key: temperature.phy
          delay: '0'
          units: ºC
          preprocessing:
            -
              type: MATCHES_REGEX
              parameters:
                - mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $..temps.PHY.first()
            -
              type: STR_REPLACE
              parameters:
                - ' C'
                - ''
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: Host
        -
          uuid: 02c08e3965f44f07a54f7335dd5f5099
          name: 'Upload Bandwidth'
          type: DEPENDENT
          key: upload_bandwidth
          delay: '0'
          units: bps
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].tx_bytes.first()'
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
            -
              type: MULTIPLIER
              parameters:
                - '8'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: c31da23a358c4c4b91265816b3429db6
          name: 'Upload Bandwidth Smooth'
          type: CALCULATED
          key: upload_bandwidth_smooth
          value_type: FLOAT
          units: bps
          params: 'avg(//upload_bandwidth,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 4a8bde0252204cbe912780251a386e7e
          name: Uptime
          type: DEPENDENT
          key: uptime
          delay: '0'
          units: S
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $.uptime
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: Host
          triggers:
            -
              uuid: 4da4bf931fc3455a9c92a4ff2153518f
              expression: 'nodata(/Unifi USG/uptime,{$UNIFI_ALERT_PERIOD})=1'
              name: '{HOST.NAME} has not reported statistics for {$UNIFI_ALERT_PERIOD}'
              priority: AVERAGE
              manual_close: 'YES'
              dependencies:
                -
                  name: '{HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
                  expression: 'nodata(/Unifi SSH High Priority Host/load_avg_1mn,{$UNIFI_ALERT_PERIOD})=1'
        -
          uuid: 8ea02a18a7b34d388b8189e7182aa386
          name: 'WAN Latency'
          type: DEPENDENT
          key: wan_latency
          delay: '0'
          units: ms
          preprocessing:
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - '$.if_table.[?(@.latency > 0)].latency.first()'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
          tags:
            -
              tag: Application
              value: wan
        -
          uuid: 673fc15b8624479089f70a6c8ab34ba7
          name: 'Wan Latency Smooth'
          type: CALCULATED
          key: wan_latency_smooth
          value_type: FLOAT
          units: ms
          params: 'avg(//wan_latency,{$UNIFI_SMOOTHING_PERIOD})'
          tags:
            -
              tag: Application
              value: wan
      discovery_rules:
        -
          uuid: feb50bd260ce4553a47bb89eeb5e46e8
          name: 'Network Discovery'
          type: DEPENDENT
          key: network_discovery
          delay: '0'
          item_prototypes:
            -
              uuid: 2e6f9468a3464faa9f2407d046fa723f
              name: '{#NETWORK_NAME} VLAN Reception Bandwidth'
              type: DEPENDENT
              key: 'vlan_rx_bandwitdh[{#NETWORK_NAME}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: NOT_MATCHES_REGEX
                  parameters:
                    - mcaDumpError
                -
                  type: JSONPATH
                  parameters:
                    - '$.network_table[ ?(@.name == ''{#NETWORK_NAME}'' ) ].stats.rx_bytes.first()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
              tags:
                -
                  tag: Application
                  value: Traffic
            -
              uuid: 1521ead6676944f881eb0ec1abe3d5ee
              name: '{#NETWORK_NAME} VLAN Transmission Bandwidth'
              type: DEPENDENT
              key: 'vlan_tx_bandwitdh[{#NETWORK_NAME}]'
              delay: '0'
              units: bps
              preprocessing:
                -
                  type: NOT_MATCHES_REGEX
                  parameters:
                    - mcaDumpError
                -
                  type: JSONPATH
                  parameters:
                    - '$.network_table[ ?(@.name == ''{#NETWORK_NAME}'' ) ].stats.tx_bytes.first()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              master_item:
                key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}","-o", "{$UNIFI_CHECK_TIMEOUT}", "-O"]'
              tags:
                -
                  tag: Application
                  value: Traffic
          graph_prototypes:
            -
              uuid: 85d0ab43c9024020818f5678c63ac6bf
              name: '{#NETWORK_NAME} Inter-VLAN Bandwidth'
              graph_items:
                -
                  sortorder: '1'
                  color: 1A7C11
                  item:
                    host: 'Unifi USG'
                    key: 'vlan_rx_bandwitdh[{#NETWORK_NAME}]'
                -
                  sortorder: '2'
                  color: F63100
                  item:
                    host: 'Unifi USG'
                    key: 'vlan_tx_bandwitdh[{#NETWORK_NAME}]'
          master_item:
            key: 'mca-dump-short.sh[ "-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "USG", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}" ]'
          lld_macro_paths:
            -
              lld_macro: '{#NETWORK_NAME}'
              path: $.name
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - mcaDumpError
              error_handler: DISCARD_VALUE
            -
              type: JSONPATH
              parameters:
                - '$.network_table[ ?(@.up == "true") ]'
    -
      uuid: c706ce3839514b87885842955e0865bf
      template: 'Unifi WiFi Site'
      name: 'Unifi WiFi Site'
      description: 'This template is meant to collect WiFi data across all of a site''s APs.  Assign to one of the APs and set the {$UNIFI_AP_GROUP} macro to the name of a group that contains all of the APs you want to aggregate against.'
      groups:
        -
          name: Patrice
        -
          name: unifiZabbix
        -
          name: 'Unifi Zabbix Export'
      items:
        -
          uuid: 1c4533c25fae47e8a07189c280f8f502
          name: 'Total Reception Wireless Bandwidth'
          type: CALCULATED
          key: 'grpsum["{$AP_GROUP}", "wireless_reception_bandwidth",avg, {$UNIFI_SMOOTHING_PERIOD}]'
          units: bps
          params: 'sum(avg_foreach(/*/wireless_reception_bandwidth?[group="{$AP_GROUP}"],{$UNIFI_SMOOTHING_PERIOD}))'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: f8bc0b7fbcea4e108b9339e385ef085f
          name: 'Total Transmission Wireless Bandwidth'
          type: CALCULATED
          key: 'grpsum["{$AP_GROUP}", "wireless_transmission_bandwidth",avg, {$UNIFI_SMOOTHING_PERIOD}]'
          units: bps
          params: 'sum(avg_foreach(/*/wireless_transmission_bandwidth?[group="{$AP_GROUP}"],{$UNIFI_SMOOTHING_PERIOD}))'
          tags:
            -
              tag: Application
              value: Radio
        -
          uuid: 24671ab8f5d44096b16f5e5b1dcb9326
          name: mca-dump
          type: EXTERNAL
          key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}" ]'
          delay: '{$UNIFI_CHECK_FREQUENCY}'
          history: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - mcaDumpError
          tags:
            -
              tag: Application
              value: Host
      discovery_rules:
        -
          uuid: e8e0ef9c01f0409e9a649e0f69ea50cf
          name: 'Discover WiFi Networks'
          type: DEPENDENT
          key: wifi_network_discovery_rule
          delay: '0'
          item_prototypes:
            -
              uuid: 460c978a4cfb40b1930c4a47dac748e9
              name: '{#ESSID}-{#RADIO_NAME} Total Reception Bandwidth'
              type: CALCULATED
              key: 'grpsum["{$AP_GROUP}", "rx_bandwidth[{#ESSID}-{#RADIO_NAME}]", avg, {$UNIFI_SMOOTHING_PERIOD}]'
              value_type: FLOAT
              units: bps
              params: 'sum(avg_foreach(/*/rx_bandwidth[{#ESSID}-{#RADIO_NAME}]?[group="{$AP_GROUP}"],{$UNIFI_SMOOTHING_PERIOD}))'
              tags:
                -
                  tag: Application
                  value: Radio
            -
              uuid: c91e55731b9d4dae8fb3d5d1ab8e1cb0
              name: '{#ESSID}-{#RADIO_NAME} Total Transmission Bandwidth'
              type: CALCULATED
              key: 'grpsum["{$AP_GROUP}", "tx_bandwidth[{#ESSID}-{#RADIO_NAME}]", avg, "{$UNIFI_SMOOTHING_PERIOD}"]'
              value_type: FLOAT
              units: bps
              params: 'sum(avg_foreach(/*/tx_bandwidth[{#ESSID}-{#RADIO_NAME}]?[group="{$AP_GROUP}"],{$UNIFI_SMOOTHING_PERIOD}))'
              tags:
                -
                  tag: Application
                  value: Radio
          graph_prototypes:
            -
              uuid: 4487c510b1ad4c5a940cfad9acc63266
              name: '{#ESSID} Bandwidth'
              graph_items:
                -
                  sortorder: '1'
                  color: 1A7C11
                  item:
                    host: 'Unifi WiFi Site'
                    key: 'grpsum["{$AP_GROUP}", "rx_bandwidth[{#ESSID}-{#RADIO_NAME}]", avg, {$UNIFI_SMOOTHING_PERIOD}]'
                -
                  sortorder: '2'
                  color: F63100
                  item:
                    host: 'Unifi WiFi Site'
                    key: 'grpsum["{$AP_GROUP}", "tx_bandwidth[{#ESSID}-{#RADIO_NAME}]", avg, "{$UNIFI_SMOOTHING_PERIOD}"]'
          master_item:
            key: 'mca-dump-short.sh["-d","{HOST.CONN}", "-u", "{$UNIFI_USER}", "-i", "{$UNIFI_SSH_PRIV_KEY_PATH}", "-t", "AP", "-p", "{$UNIFI_SSHPASS_PASSWORD_PATH}", "-o", "{$UNIFI_CHECK_TIMEOUT}" ]'
          lld_macro_paths:
            -
              lld_macro: '{#ESSID}'
              path: $.essid
            -
              lld_macro: '{#RADIO_NAME}'
              path: $.radio
          preprocessing:
            -
              type: NOT_MATCHES_REGEX
              parameters:
                - mcaDumpError
            -
              type: CHECK_JSON_ERROR
              parameters:
                - $.mcaDumpError
            -
              type: JSONPATH
              parameters:
                - $.vap_table
      macros:
        -
          macro: '{$AP_GROUP}'
          value: 'Override me!'
          description: 'The name of the group containing the site MAPs'
  triggers:
    -
      uuid: 10f0713611da4380a8120294fc928a08
      expression: 'last(/Unifi Protect Camera/tx_bandwidth_smooth,#1) < last(/Unifi Protect Camera/outgoing_bandwidth_moving_average_threshold_raw,#1) and last(/Unifi Protect Camera/tx_bandwidth,#1) < last(/Unifi Protect Camera/outgoing_bandwidth_moving_average_threshold_raw,#1)'
      name: 'Camera {HOST.NAME} Outgoing Bandwidth Low'
      priority: INFO
      dependencies:
        -
          name: 'Camera {HOST.NAME} has not been pingable for more than {$UNIFI_ALERT_PERIOD}'
          expression: 'max(/Unifi Protect Camera/icmpping[],{$UNIFI_ALERT_PERIOD})=0'
        -
          name: 'Camera {HOST.NAME} Outgoing Bandwidth Low'
          expression: 'avg(/Unifi Protect Camera/tx_bandwidth,10m)<{$PROTECT_LOW_BANDWIDTH}'
        -
          name: 'Camera {HOST.NAME} SSH has not been available for more than {$UNIFI_ALERT_PERIOD}'
          expression: 'nodata(/Unifi Protect Camera/ssh.run[ifconfig],{$UNIFI_ALERT_PERIOD})=1'
      tags:
        -
          tag: Application
          value: Protect
    -
      uuid: 986b14fb36e8416ca24d2af88b06b613
      expression: 'avg(/Unifi Protect Cloud Key/IpExtInOctets,3600s) < last(/Unifi Protect Cloud Key/incoming_bandwidth_moving_average_threshold,#1)'
      name: '{HOST.NAME} Incoming Bandwidth Too Low'
      priority: WARNING
      manual_close: 'YES'
    -
      uuid: 8e2e73da9a224f61b24511db3c331864
      expression: 'avg(/Unifi Protect NVR4/IpExtInOctets,1h) < last(/Unifi Protect NVR4/incoming_bandwidth_moving_average_threshold,#1)'
      name: '{HOST.NAME} Incoming Bandwidth Too Low'
      priority: WARNING
      manual_close: 'YES'
    -
      uuid: 52cec550f270441f9c5cdd764897ce53
      expression: 'last(/Unifi Protect NVR4/ssh.run[temp1],#1)>{$UNIFI_ALERT_TEMP} or last(/Unifi Protect NVR4/ssh.run[temp2],#1)>{$UNIFI_ALERT_TEMP} or last(/Unifi Protect NVR4/ssh.run[temp3],#1)>{$UNIFI_ALERT_TEMP}'
      name: '{HOST.NAME} is hot'
      priority: WARNING
    -
      uuid: d71b7c4cdb084f10b4556d2cadd84f8d
      expression: 'last(/Unifi SSH High Priority Host/load_avg_15mn,#1)>last(/Unifi SSH High Priority Host/ssh.run[nproc],#1)*{$UNIFI_LOAD_AVERAGE_HIGH}'
      name: '{HOST.NAME} load average is > {$UNIFI_LOAD_AVERAGE_HIGH} per processor'
      priority: WARNING
      manual_close: 'YES'
    -
      uuid: 665ee1289cf94f318e26c9e7474e4229
      expression: 'last(/Unifi SSH Host/load_avg_15mn,#1)>last(/Unifi SSH Host/ssh.run[nproc],#1)*{$UNIFI_LOAD_AVERAGE_HIGH}'
      name: '{HOST.NAME} load average is > {$UNIFI_LOAD_AVERAGE_HIGH} per processor'
      priority: WARNING
      manual_close: 'YES'
    -
      uuid: b601c0fbee6e48668ec03ff912b5304c
      expression: 'last(/Unifi SSH High Priority Host/load_avg_15mn,#1)>last(/Unifi SSH High Priority Host/ssh.run[nproc],#1)*{$UNIFI_LOAD_AVERAGE_MEDIUM}'
      name: '{HOST.NAME} Load average is > {$UNIFI_LOAD_AVERAGE_MEDIUM} per processor'
      priority: INFO
      manual_close: 'YES'
      dependencies:
        -
          name: '{HOST.NAME} load average is > {$UNIFI_LOAD_AVERAGE_HIGH} per processor'
          expression: 'last(/Unifi SSH High Priority Host/load_avg_15mn,#1)>last(/Unifi SSH High Priority Host/ssh.run[nproc],#1)*{$UNIFI_LOAD_AVERAGE_HIGH}'
    -
      uuid: 22986a62ed9b40ec9c89acecff5045fa
      expression: 'last(/Unifi SSH Host/load_avg_15mn,#1)>last(/Unifi SSH Host/ssh.run[nproc],#1)*{$UNIFI_LOAD_AVERAGE_MEDIUM}'
      name: '{HOST.NAME} Load average is > {$UNIFI_LOAD_AVERAGE_MEDIUM} per processor'
      priority: INFO
      manual_close: 'YES'
      dependencies:
        -
          name: '{HOST.NAME} load average is > {$UNIFI_LOAD_AVERAGE_HIGH} per processor'
          expression: 'last(/Unifi SSH Host/load_avg_15mn,#1)>last(/Unifi SSH Host/ssh.run[nproc],#1)*{$UNIFI_LOAD_AVERAGE_HIGH}'
  graphs:
    -
      uuid: 6800f3a3becb44ffbabb02587276d1c5
      name: 'Air Time'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'UBNT Airmax'
            key: airTimeSmooth
    -
      uuid: 97ccfef4197444c69af57ca79513fd16
      name: Bandwidth
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi Protect NVR4'
            key: IpExtInOctets
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi Protect NVR4'
            key: incoming_bandwidth_moving_average_threshold
    -
      uuid: a1b1190f8dfa4c9694f69132ea7027a2
      name: Bandwidth
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi UDMP'
            key: download_bandwidth
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi UDMP'
            key: upload_bandwidth
    -
      uuid: d09d7d135dfc49d0b35e2a0ed5d2ac20
      name: Bandwidth
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi USG'
            key: download_bandwidth_smooth
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi USG'
            key: upload_bandwidth_smooth
    -
      uuid: 0d21337806de4d03bda1b762c0a98ee4
      name: Bandwidth
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi AP'
            key: wireless_reception_bandwidth
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi AP'
            key: wireless_transmission_bandwidth
    -
      uuid: fad2952510f34a4897c8194393d3e6e3
      name: Bandwidth
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi Protect Camera'
            key: rx_bandwidth
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi Protect Camera'
            key: tx_bandwidth
        -
          sortorder: '3'
          color: 2774A4
          item:
            host: 'Unifi Protect Camera'
            key: tx_bandwidth_smooth
        -
          sortorder: '4'
          color: A54F10
          item:
            host: 'Unifi Protect Camera'
            key: outgoing_bandwidth_moving_average_threshold_raw
    -
      uuid: dd9c1e7a2b6a44a590a8ce1e131e75ed
      name: 'Bandwidth Used'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'UBNT Airmax'
            key: wlanRxBandwidthSmooth
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'UBNT Airmax'
            key: wlanTxBandwidthSmooth
    -
      uuid: 8853a3813ca8403eb6199379f8349834
      name: 'Charge and Voltage'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          yaxisside: RIGHT
          item:
            host: 'SunMAX SolarPoint'
            key: batteryCharge
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'SunMAX SolarPoint'
            key: batteryVoltage
    -
      uuid: f7f3c8e61e564d0d9f8057f70d9c0072
      name: 'CPU and Memory'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi UDMP'
            key: cpu
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi UDMP'
            key: memory
    -
      uuid: 77b6b90c95ee43ed89899a355d9449f0
      name: 'CPU and Memory'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi Switch'
            key: cpu_smooth
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi Switch'
            key: memory
    -
      uuid: 347ef23ef5a94b629dabcc89b74331a0
      name: 'CPU and Memory'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi USG'
            key: cpu_smooth
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi USG'
            key: memory
    -
      uuid: 2cec753f0a24451fb95a06fd19a0ae8d
      name: 'Incoming Bandwidth'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi Protect Cloud Key'
            key: IpExtInOctets
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi Protect Cloud Key'
            key: incoming_bandwidth_moving_average_threshold
    -
      uuid: 10507414af274cf19b4bc87a2b85d55d
      name: Latency
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi UDMP'
            key: wan_latency
    -
      uuid: 47ef7a2c34d24f75bb0453105a57974e
      name: 'Load Averages'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi SSH Host'
            key: load_avg_1mn
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi SSH Host'
            key: load_avg_15mn
        -
          sortorder: '3'
          color: 2774A4
          item:
            host: 'Unifi SSH Host'
            key: load_avg_5mn
    -
      uuid: cd4b89f3fff24baf877bcf444a62f05d
      name: 'Load Averages'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi SSH High Priority Host'
            key: load_avg_1mn
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi SSH High Priority Host'
            key: load_avg_15mn
        -
          sortorder: '3'
          color: 2774A4
          item:
            host: 'Unifi SSH High Priority Host'
            key: load_avg_5mn
    -
      uuid: defcfe28a659470c929684a6c51957fe
      name: 'Power I/O'
      graph_items:
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: 'SunMAX SolarPoint'
            key: net_power_consumption
    -
      uuid: 01686902f0154cc99cf027792a39adc9
      name: 'Signal and Noise'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'UBNT Airmax'
            key: noiseSmooth
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'UBNT Airmax'
            key: signalSmooth
    -
      uuid: febf8b739918467488438aff431f944e
      name: 'Temperature and Fan Speed'
      graph_items:
        -
          color: 1A7C11
          yaxisside: RIGHT
          item:
            host: 'Unifi UDMP'
            key: fanSpeed
        -
          sortorder: '1'
          color: F63100
          item:
            host: 'Unifi UDMP'
            key: temp1
        -
          sortorder: '2'
          color: 2774A4
          item:
            host: 'Unifi UDMP'
            key: temperature.cpu
        -
          sortorder: '3'
          color: A54F10
          item:
            host: 'Unifi UDMP'
            key: temperature.phy
    -
      uuid: 32f787121dc94a769829896a44364785
      name: 'Total Embedded Switch Bandwidth'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi UDMP'
            key: total_switch_rx_bandwidth
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi UDMP'
            key: total_switch_tx_bandwidth
    -
      uuid: 160a7ded8ed04fbdba40c5126962be4a
      name: 'Total Traffic'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi Switch'
            key: total_rx_bandwidth
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi Switch'
            key: total_rx_bandwidth
    -
      uuid: aa28d9dbd34e4cdfb0e4447dbdb171ef
      name: 'Total WiFi Bandwidth'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Unifi WiFi Site'
            key: 'grpsum["{$AP_GROUP}", "wireless_reception_bandwidth",avg, {$UNIFI_SMOOTHING_PERIOD}]'
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Unifi WiFi Site'
            key: 'grpsum["{$AP_GROUP}", "wireless_transmission_bandwidth",avg, {$UNIFI_SMOOTHING_PERIOD}]'
